<div class="flex-1 flex flex-col bg-gray-700 text-gray-100">
  <!-- Enhanced Header Section -->
  <header class="bg-gradient-to-r from-gray-800 to-gray-700 border-b border-gray-600 shadow-lg">
    <!-- Title and Stats Section -->
    <div class="px-4 sm:px-6 py-4 sm:py-6 border-b border-gray-600/50">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        <!-- Title Section -->
        <div class="flex items-center space-x-3">
          <div class="p-2 bg-blue-600/20 rounded-lg">
            <i class="fas fa-users text-blue-400 text-xl"></i>
          </div>
          <div>
            <h1 class="text-2xl sm:text-3xl font-bold text-white">User & KYC Management</h1>
            <p class="text-gray-400 text-sm mt-1">Monitor and manage user accounts with KYC verification</p>
          </div>
        </div>
        
        <!-- Stats Cards -->
        <div class="flex items-center space-x-3 sm:space-x-4">
          <div class="bg-gray-700/50 backdrop-blur-sm rounded-xl px-3 sm:px-4 py-2 sm:py-3 border border-gray-600/50 flex-1 sm:flex-none">
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
              <span class="text-xs sm:text-sm text-gray-300">Total Users</span>
            </div>
            <div class="text-xl sm:text-2xl font-bold text-white mt-1">{{ statusCounts().total }}</div>
          </div>
          <div class="bg-gray-700/50 backdrop-blur-sm rounded-xl px-3 sm:px-4 py-2 sm:py-3 border border-gray-600/50 flex-1 sm:flex-none">
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
              <span class="text-xs sm:text-sm text-gray-300">Filtered</span>
            </div>
            <div class="text-xl sm:text-2xl font-bold text-white mt-1">{{ filteredKycUsers().length }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Search and Filters Section -->
    <div class="px-4 sm:px-6 py-4 sm:py-6">
      <div class="flex flex-col gap-4">
        <!-- Search Bar -->
        <div class="w-full">
          <label class="block text-sm font-medium text-gray-300 mb-2">Search Users</label>
          <div class="relative search-input-container">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-search search-icon"></i>
              <svg class="search-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </div>
            <input 
              type="search" 
              [ngModel]="searchTerm()" 
              (ngModelChange)="searchTerm.set($event); onSearchChange()"
              placeholder="Search by name, email, phone, location, Aadhar, or PAN..."
              class="w-full pl-10 pr-4 py-2.5 bg-gray-800/50 border border-gray-600/50 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 transition-all duration-200 backdrop-blur-sm"
            />
          </div>
        </div>

        <!-- Filters and Actions Row -->
        <div class="flex flex-col sm:flex-row gap-4">
          <!-- Filters Group -->
          <div class="flex flex-col sm:flex-row gap-4 flex-1">
            <div class="flex-1 min-w-0">
              <label class="block text-sm font-medium text-gray-300 mb-2">KYC Status</label>
              <select 
                [ngModel]="kycStatusFilter()" 
                (ngModelChange)="kycStatusFilter.set($event); onKycStatusFilterChange()"
                class="w-full px-3 py-2.5 bg-gray-800/50 border border-gray-600/50 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 transition-all duration-200 backdrop-blur-sm"
              >
                <option value="all">All KYC Status</option>
                <option value="pending">Pending</option>
                <option value="submitted">Submitted</option>
                <option value="approved">Approved</option>
                <option value="rejected">Rejected</option>
              </select>
            </div>

            <div class="flex-1 min-w-0">
              <label class="block text-sm font-medium text-gray-300 mb-2">User Status</label>
              <select 
                [ngModel]="userStatusFilter()" 
                (ngModelChange)="userStatusFilter.set($event); onUserStatusFilterChange()"
                class="w-full px-3 py-2.5 bg-gray-800/50 border border-gray-600/50 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 transition-all duration-200 backdrop-blur-sm"
              >
                <option value="all">All User Status</option>
                <option value="active">Active</option>
                <option value="suspended">Suspended</option>
                <option value="deactivated">Deactivated</option>
              </select>
            </div>

            <div class="flex-1 min-w-0">
              <label class="block text-sm font-medium text-gray-300 mb-2">Date Range</label>
              <select 
                [ngModel]="dateRangeFilter()" 
                (ngModelChange)="dateRangeFilter.set($event); onDateRangeFilterChange()"
                class="w-full px-3 py-2.5 bg-gray-800/50 border border-gray-600/50 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 transition-all duration-200 backdrop-blur-sm"
              >
                <option value="all">All Time</option>
                <option value="today">Today</option>
                <option value="week">Last Week</option>
                <option value="month">Last Month</option>
              </select>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex items-end gap-2 sm:ml-auto">
            <button 
              (click)="clearFilters()" 
              class="inline-flex items-center justify-center gap-1.5 px-3 py-2.5 bg-gray-700/50 hover:bg-gray-600/50 border border-gray-600/50 rounded-lg text-gray-300 hover:text-white text-sm font-medium transition-all duration-200 backdrop-blur-sm hover:border-gray-500/50 h-10"
            >
              <i class="fas fa-times text-sm"></i>
              <span>Clear</span>
            </button>

            <button 
              (click)="viewSuspensionStats()" 
              class="inline-flex items-center justify-center gap-1.5 px-3 py-2.5 bg-gray-700/50 hover:bg-gray-600/50 border border-gray-600/50 rounded-lg text-gray-300 hover:text-white text-sm font-medium transition-all duration-200 backdrop-blur-sm hover:border-gray-500/50 h-10"
            >
              <i class="fas fa-chart-bar text-sm"></i>
              <span>Stats</span>
            </button>

            <button 
              (click)="exportData()" 
              class="inline-flex items-center justify-center gap-1.5 px-3 py-2.5 bg-gray-700/50 hover:bg-gray-600/50 border border-gray-600/50 rounded-lg text-gray-300 hover:text-white text-sm font-medium transition-all duration-200 backdrop-blur-sm hover:border-gray-500/50 h-10"
            >
              <i class="fas fa-download text-sm"></i>
              <span>Export</span>
            </button>

            <button 
              (click)="loadUsers()"
              [disabled]="isLoading()"
              class="inline-flex items-center justify-center gap-1.5 px-4 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 rounded-lg text-white text-sm font-medium shadow-sm hover:shadow-md transition-all duration-200 transform hover:scale-105 h-10 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              <i class="fas fa-sync-alt text-sm" [class.animate-spin]="isLoading()"></i>
              <span>Refresh</span>
            </button>

            <button 
              (click)="openAddUserModal()"
              class="inline-flex items-center justify-center gap-1.5 px-4 py-2.5 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 rounded-lg text-white text-sm font-medium shadow-sm hover:shadow-md transition-all duration-200 transform hover:scale-105 h-10"
            >
              <i class="fas fa-plus text-sm"></i>
              <span>Add User</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Messages -->
  <div *ngIf="error()" class="mb-4 bg-red-900/20 border border-red-600/50 rounded-lg p-4">
    <div class="flex">
      <div class="flex-shrink-0">
        <i class="fas fa-exclamation-triangle text-red-400"></i>
      </div>
      <div class="ml-3">
        <p class="text-sm text-red-300">{{ error() }}</p>
      </div>
      <div class="ml-auto pl-3">
        <button (click)="clearMessages()" class="text-red-400 hover:text-red-300">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  </div>

  <div *ngIf="success()" class="mb-4 bg-green-900/20 border border-green-600/50 rounded-lg p-4">
    <div class="flex">
      <div class="flex-shrink-0">
        <i class="fas fa-check-circle text-green-400"></i>
      </div>
      <div class="ml-3">
        <p class="text-sm text-green-300">{{ success() }}</p>
      </div>
      <div class="ml-auto pl-3">
        <button (click)="clearMessages()" class="text-green-400 hover:text-green-300">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  </div>

  <main class="flex-1 py-4 overflow-auto">
    <section class="max-w-7xl mx-auto">
      <div class="h-full rounded-xl border border-gray-700 bg-gray-900 shadow-sm min-w-0">
        <!-- Loading State -->
        <div *ngIf="isLoading()" class="flex items-center justify-center py-12">
          <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
          <span class="ml-2 text-gray-400">Loading users...</span>
        </div>

        <!-- Table Container -->
        <div *ngIf="!isLoading()" class="table-container" style="max-height: 72vh;">
          <table class="min-w-full divide-y divide-gray-700" role="table" aria-label="Users table">
          <thead>
            <tr class="bg-gray-800">
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">User</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Contact</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Location</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">User Status</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">KYC Status</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase">Joined</th>
              <th class="px-6 py-3 text-center text-xs font-medium text-gray-300 uppercase">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-700 bg-gray-900">
            <tr *ngIf="paginatedUsers().length === 0" class="text-center">
              <td colspan="7" class="px-6 py-12 text-gray-400">
                <p class="text-lg font-medium text-gray-500 mb-2">No users found</p>
              </td>
            </tr>
            <tr *ngFor="let user of paginatedUsers()" class="hover:bg-gray-800 transition duration-150">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="h-12 w-12 flex-shrink-0 overflow-hidden rounded-full border border-gray-700">
                    <img [src]="getUserImage(user)" [alt]="user.name" class="h-12 w-12 object-cover" (error)="onImageError($event)" />
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-100">{{ user.name }}</div>
                    <div class="text-xs text-gray-400">{{ user.email }}</div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-300">
                  <div class="flex items-center mb-1">
                    <i class="fas fa-phone text-gray-400 mr-2 text-xs"></i>
                    <span>{{ getDisplayValue(user.phone) }}</span>
                  </div>
                  <div class="text-xs text-gray-400">
                    Born: {{ user.dateofbirth ? formatDate(user.dateofbirth) : 'Not provided' }}
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-300">
                  <div class="flex items-center mb-1">
                    <i class="fas fa-map-marker-alt text-gray-400 mr-2 text-xs"></i>
                    <span>{{ getDisplayValue(user.location) }}</span>
                  </div>
                  <div class="text-xs text-gray-400">
                    PIN: {{ getDisplayValue(user.pincode) }}
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex flex-col space-y-1">
                  <span class="inline-flex items-center rounded-full px-3 py-0.5 text-xs font-medium" 
                        [class]="getStatusClass(user.status)">
                    <span class="mr-1">{{ getStatusIcon(user.status) }}</span>
                    {{ user.status || 'active' }}
                  </span>
                  <div *ngIf="user.status === 'suspended' && user.suspensionEndDate" class="text-xs text-yellow-400">
                    Until: {{ formatSuspensionEndDate(user.suspensionEndDate) }}
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex items-center rounded-full px-3 py-0.5 text-xs font-medium capitalize" 
                      [class]="getKycStatusClass(user.kycStatus)">
                  <img [src]="getKycStatusIconSvg(user.kycStatus || 'pending')" alt="Status" class="w-3 h-3 mr-1">
                  {{ user.kycStatus || 'pending' }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-300">{{ formatDate(user.createdAt!) }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-center">
                <div class="flex items-center justify-center space-x-2">
                  <button (click)="viewUserDetails(user)" class="p-2 text-gray-300 hover:text-blue-300 rounded-lg hover:bg-gray-800 transition" 
                          title="View Details" [attr.aria-label]="'View details for ' + user.name">
                    <i class="fas fa-eye text-sm"></i>
                  </button>

                  <button (click)="openEditUserModal(user)" class="p-2 text-gray-300 hover:text-yellow-300 rounded-lg hover:bg-gray-800 transition" 
                          title="Edit User" [attr.aria-label]="'Edit user ' + user.name">
                    <i class="fas fa-edit text-sm"></i>
                  </button>

                  <!-- Status Management Actions -->
                  <button *ngIf="user.status !== 'deactivated'" 
                          (click)="openStatusModal(user, 'suspend')" class="p-2 text-gray-300 hover:text-orange-300 rounded-lg hover:bg-gray-800 transition" 
                          title="Suspend User" [attr.aria-label]="'Suspend user ' + user.name">
                    <i class="fas fa-pause text-sm"></i>
                  </button>

                  <button *ngIf="user.status !== 'active'" 
                          (click)="openStatusModal(user, 'reactivate')" class="p-2 text-gray-300 hover:text-green-300 rounded-lg hover:bg-gray-800 transition" 
                          title="Reactivate User" [attr.aria-label]="'Reactivate user ' + user.name">
                    <i class="fas fa-play text-sm"></i>
                  </button>

                  <button *ngIf="user.status !== 'deactivated'" 
                          (click)="openStatusModal(user, 'deactivate')" class="p-2 text-gray-300 hover:text-red-300 rounded-lg hover:bg-gray-800 transition" 
                          title="Deactivate User" [attr.aria-label]="'Deactivate user ' + user.name">
                    <i class="fas fa-ban text-sm"></i>
                  </button>

                  <button (click)="viewStatusHistory(user)" class="p-2 text-gray-300 hover:text-purple-300 rounded-lg hover:bg-gray-800 transition" 
                          title="View Status History" [attr.aria-label]="'View status history for ' + user.name">
                    <i class="fas fa-history text-sm"></i>
                  </button>
                  
                  <button *ngIf="user.kycStatus === 'submitted'"
                          (click)="approveKyc(user._id!)" class="p-2 text-gray-300 hover:text-green-300 rounded-lg hover:bg-gray-800 transition" 
                          title="Approve KYC" [attr.aria-label]="'Approve KYC for ' + user.name">
                    <i class="fas fa-check text-sm"></i>
                  </button>
                  
                  <button *ngIf="user.kycStatus === 'submitted'"
                          (click)="openRejectModal(user)" class="p-2 text-gray-300 hover:text-red-300 rounded-lg hover:bg-gray-800 transition" 
                          title="Reject KYC" [attr.aria-label]="'Reject KYC for ' + user.name">
                    <i class="fas fa-times text-sm"></i>
                  </button>
                  
                  <button (click)="deleteUser(user)" class="p-2 text-gray-300 hover:text-red-300 rounded-lg hover:bg-gray-800 transition" 
                          title="Delete User" [attr.aria-label]="'Delete user ' + user.name">
                    <i class="fas fa-trash text-sm"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
        
        <!-- Pagination -->
        <div class="flex items-center justify-between border-t border-gray-700 bg-gray-900 px-6 py-4">
          <div class="flex items-center space-x-2 text-sm text-gray-300">
            <span>Showing</span>
            <span class="font-medium text-gray-100">{{ (currentPage - 1) * itemsPerPage + 1 }}</span>
            <span>to</span>
            <span class="font-medium text-gray-100">{{ getMin(currentPage * itemsPerPage, filteredKycUsers().length) }}</span>
            <span>of</span>
            <span class="font-medium text-gray-100">{{ filteredKycUsers().length }}</span>
            <span>users</span>
          </div>
          <div class="flex items-center space-x-2">
            <button [disabled]="currentPage === 1" 
                    (click)="goToPage(currentPage - 1)"
                    class="inline-flex items-center justify-center rounded-lg border border-gray-700 px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition duration-150">
              Previous
            </button>
            
            <!-- Page Numbers -->
            <div class="flex items-center space-x-1">
              <button *ngFor="let page of getPageNumbers()" 
                      (click)="goToPage(page)" 
                      [class]="'px-3 py-2 rounded-lg text-sm font-medium transition ' + (page === currentPage ? 'bg-blue-600 text-white' : 'text-gray-300 hover:bg-gray-800 border border-gray-700')">
                {{ page }}
              </button>
            </div>
            
            <button [disabled]="currentPage === totalPages || totalPages === 0" 
                    (click)="goToPage(currentPage + 1)"
                    class="inline-flex items-center justify-center rounded-lg border border-gray-700 px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition duration-150">
              Next
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- View User Details Modal -->
<div *ngIf="selectedUser()" class="fixed inset-0 bg-gray-900/90 backdrop-blur-sm overflow-y-auto h-full w-full z-[80]">
  <div class="relative top-10 mx-auto p-6 w-full max-w-6xl shadow-2xl rounded-2xl bg-gray-800 border border-gray-700">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-semibold text-white">User & KYC Details</h3>
      <button (click)="closeUserDialog()" class="text-gray-400 hover:text-white transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Left Column -->
      <div class="space-y-6">
        <!-- User Information -->
        <div class="bg-gray-700/50 rounded-lg p-6 border border-gray-600">
          <h4 class="text-lg font-semibold text-white mb-4">Personal Information</h4>
          <div class="flex items-center space-x-4 mb-4">
            <div class="h-20 w-20 flex-shrink-0 overflow-hidden rounded-full border border-gray-600">
              <img [src]="getUserImage(selectedUser()!)" [alt]="selectedUser()!.name" class="h-20 w-20 object-cover" (error)="onImageError($event)">
            </div>
            <div>
              <h5 class="text-xl font-semibold text-white">{{ selectedUser()!.name }}</h5>
              <p class="text-gray-400">{{ selectedUser()!.email }}</p>
              <span class="inline-flex items-center rounded-full px-3 py-0.5 text-xs font-medium mt-2" 
                    [class]="getKycStatusClass(selectedUser()!.kycStatus)">
                <img [src]="getKycStatusIconSvg(selectedUser()!.kycStatus || 'pending')" alt="Status" class="w-4 h-4 mr-1">
                KYC: {{ selectedUser()!.kycStatus || 'pending' }}
              </span>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-sm text-gray-400">Phone</p>
              <p class="font-medium text-white">{{ getDisplayValue(selectedUser()!.phone) }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-400">Date of Birth</p>
              <p class="font-medium text-white">{{ selectedUser()!.dateofbirth ? formatDate(selectedUser()!.dateofbirth) : 'Not provided' }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-400">Location</p>
              <p class="font-medium text-white">{{ getDisplayValue(selectedUser()!.location) }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-400">Pincode</p>
              <p class="font-medium text-white">{{ getDisplayValue(selectedUser()!.pincode) }}</p>
            </div>
          </div>
          <div class="mt-4">
            <p class="text-sm text-gray-400">Address</p>
            <p class="text-white">{{ getDisplayValue(selectedUser()!.address) }}</p>
          </div>
        </div>

        <!-- KYC Documents -->
        <div class="bg-gray-700/50 rounded-lg p-6 border border-gray-600">
          <h4 class="text-lg font-semibold text-white mb-4">KYC Documents</h4>
          <div *ngIf="selectedUser()!.kycDocs && selectedUser()!.kycDocs!.length > 0; else noDocsTemplate">
            <div class="grid grid-cols-1 gap-4">
              <div *ngFor="let doc of selectedUser()!.kycDocs; let i = index" class="border border-gray-600 rounded-lg p-4 bg-gray-800">
                <div class="flex items-center justify-between">
                  <div class="flex items-center flex-1 min-w-0">
                    <img [src]="getDocumentIconSvg()" alt="Document" class="mr-3 w-6 h-6 flex-shrink-0" />
                    <div class="min-w-0 flex-1">
                      <p class="text-sm font-medium text-white truncate">{{ getCleanDocumentName(doc, i) }}</p>
                      <p class="text-xs text-gray-400">{{ getDocumentType(doc) }}</p>
                    </div>
                  </div>
                  <div class="flex items-center space-x-2 ml-4">
                    <button 
                      (click)="viewDocument(doc)" 
                      class="text-blue-400 hover:text-blue-300 text-sm transition-colors duration-200 px-3 py-1 rounded-md bg-blue-900/20 hover:bg-blue-900/30"
                      title="View document">
                      <i class="fas fa-eye mr-1"></i>
                      View
                    </button>
                    <button 
                      (click)="downloadDocument(doc, getCleanDocumentName(doc, i))" 
                      class="text-green-400 hover:text-green-300 text-sm transition-colors duration-200 px-3 py-1 rounded-md bg-green-900/20 hover:bg-green-900/30"
                      title="Download document">
                      <i class="fas fa-download mr-1"></i>
                      Download
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <ng-template #noDocsTemplate>
            <div class="text-center py-8">
              <div class="mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mx-auto text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
              </div>
              <p class="text-gray-400 font-medium">No KYC documents available</p>
              <p class="text-gray-500 text-sm mt-1">User has not uploaded any KYC documents yet</p>
            </div>
          </ng-template>
        </div>
      </div>

      <!-- Right Column -->
      <div class="space-y-6">
        <!-- Government ID Information -->
        <div class="bg-gray-700/50 rounded-lg p-6 border border-gray-600">
          <h4 class="text-lg font-semibold text-white mb-4">Government ID Information</h4>
          <div class="grid grid-cols-1 gap-4">
            <div>
              <p class="text-sm text-gray-400">Aadhar ID</p>
              <p class="font-medium text-white">{{ getDisplayValue(selectedUser()!.governmentid?.aadharid) }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-400">PAN ID</p>
              <p class="font-medium text-white">{{ getDisplayValue(selectedUser()!.governmentid?.panid) }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-400">License ID</p>
              <p class="font-medium text-white">{{ getDisplayValue(selectedUser()!.governmentid?.licenseid) }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-400">Income</p>
              <p class="font-medium text-white">{{ getDisplayValue(selectedUser()!.governmentid?.income) }}</p>
            </div>
          </div>
        </div>

        <!-- KYC Status and History -->
        <div class="bg-gray-700/50 rounded-lg p-6 border border-gray-600">
          <h4 class="text-lg font-semibold text-white mb-4">KYC Status & History</h4>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <p class="text-sm text-gray-400">Status</p>
              <span class="inline-flex items-center rounded-full px-3 py-0.5 text-xs font-medium capitalize status-badge" [attr.data-status]="selectedUser()!.kycStatus">
                <img [src]="getKycStatusIconSvg(selectedUser()!.kycStatus || 'pending')" alt="Status" class="w-4 h-4 mr-1">
                {{ selectedUser()!.kycStatus || 'pending' }}
              </span>
            </div>
            <div>
              <p class="text-sm text-gray-400">Created</p>
              <p class="font-medium text-white">{{ formatDate(selectedUser()!.createdAt!) }}</p>
            </div>
            <div *ngIf="selectedUser()?.kycApprovedBy">
              <p class="text-sm text-gray-400">Approved By</p>
              <p class="font-medium text-white">{{ getDisplayValue(selectedUser()?.kycApprovedBy?.name) }} ({{ getDisplayValue(selectedUser()?.kycApprovedBy?.role) }})</p>
            </div>
          </div>
          
          <div *ngIf="selectedUser()!.rejected_comments && selectedUser()!.rejected_comments!.length > 0" class="mt-4">
            <h5 class="text-sm font-medium text-white mb-2">Rejection Comments</h5>
            <div class="space-y-2">
              <div *ngFor="let comment of selectedUser()!.rejected_comments" class="p-3 bg-red-900/20 border border-red-600/50 rounded-md">
                <p class="text-sm text-red-300">{{ comment.comment }}</p>
                <p class="text-xs text-red-400 mt-1">{{ formatDate(comment.date) }}</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- KYC Actions -->
        <div *ngIf="selectedUser()!.kycStatus === 'submitted'" class="bg-gray-700/50 rounded-lg p-6 border border-gray-600">
          <h4 class="text-lg font-semibold text-white mb-4">KYC Actions</h4>
          <div class="flex space-x-4">
            <button 
              (click)="approveKyc(selectedUser()!._id!)"
              class="flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
              <i class="fas fa-check mr-2"></i>
              Approve KYC
            </button>
            <button 
              (click)="openRejectModal(selectedUser()!)"
              class="flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
              <i class="fas fa-times mr-2"></i>
              Reject KYC
            </button>
          </div>
        </div>
        
        <div *ngIf="selectedUser()!.kycStatus === 'pending'" class="bg-gray-700/50 rounded-lg p-6 border border-gray-600">
          <div class="text-center py-4">
            <i class="fas fa-clock text-yellow-400 text-2xl mb-2"></i>
            <p class="text-yellow-300 font-medium">KYC Pending</p>
            <p class="text-gray-400 text-sm">User has not submitted KYC documents yet</p>
          </div>
        </div>
      </div>
    </div>

    <!-- User Activity Data (Tickets, Tokens, Book Now Tokens) -->
    <div class="mt-8">
      <h4 class="text-xl font-semibold text-white mb-6">User Activity & Purchases</h4>
      
      <!-- Loading State -->
      <div *ngIf="loadingUserDetails()" class="text-center py-8">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-white"></div>
        <p class="text-gray-400 mt-2">Loading user activity...</p>
      </div>

      <!-- Tabs for different data types -->
      <div *ngIf="!loadingUserDetails()" class="mb-6">
        <div class="border-b border-gray-700">
          <nav class="-mb-px flex space-x-8">
            <button [class.border-blue-500]="isTicketsTabActive()" [class.text-blue-400]="isTicketsTabActive()" [class.border-transparent]="!isTicketsTabActive()" [class.text-gray-400]="!isTicketsTabActive()" (click)="setActiveTab('tickets')" class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200">
              Tickets ({{ userTickets().length }})
            </button>
            <button [class.border-blue-500]="isTokensTabActive()" [class.text-blue-400]="isTokensTabActive()" [class.border-transparent]="!isTokensTabActive()" [class.text-gray-400]="!isTokensTabActive()" (click)="setActiveTab('tokens')" class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200">
              Waitlist Tokens ({{ userTokens().length }})
            </button>
            <button [class.border-blue-500]="isBookNowTokensTabActive()" [class.text-blue-400]="isBookNowTokensTabActive()" [class.border-transparent]="!isBookNowTokensTabActive()" [class.text-gray-400]="!isBookNowTokensTabActive()" (click)="setActiveTab('bookNowTokens')" class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm transition-colors duration-200">
              Book Now Tokens ({{ userBookNowTokens().length }})
            </button>
          </nav>
        </div>
      </div>

      <!-- Tickets Tab -->
      <div *ngIf="!loadingUserDetails() && isTicketsTabActive()">
        <div *ngIf="userTickets().length > 0; else noTicketsTemplate" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div *ngFor="let ticket of userTickets()" class="bg-gray-700/50 rounded-lg p-4 border border-gray-600">
            <div class="flex justify-between items-start mb-3">
              <div>
                <h5 class="font-semibold text-white">{{ ticket.ticketcustomid }}</h5>
                <span class="inline-flex items-center px-3 py-0.5 rounded-full text-xs font-medium" 
                      [class]="ticket.ticketstatus === 'active' ? 'status-badge-approved' : ticket.ticketstatus === 'expired' ? 'status-badge-rejected' : 'status-badge-inactive'">
                  {{ ticket.ticketstatus }}
                </span>
              </div>
            </div>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-400">Price:</span>
                <span class="text-white font-medium">₹{{ ticket.ticketprice | number }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Paid:</span>
                <span class="text-white font-medium">₹{{ ticket.pricepaid | number }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Pending:</span>
                <span class="text-white font-medium">₹{{ ticket.pendingamount | number }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Purchased:</span>
                <span class="text-white">{{ formatDate(ticket.ticketbroughtdate) }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Expires:</span>
                <span class="text-white">{{ formatDate(ticket.ticketexpiry) }}</span>
              </div>
              <div *ngIf="ticket.resold" class="text-orange-400 text-xs font-medium">
                ⚠️ Resold
              </div>
            </div>
          </div>
        </div>
        <ng-template #noTicketsTemplate>
          <div class="text-center py-12">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mx-auto text-gray-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
            </svg>
            <p class="text-gray-400 font-medium">No tickets found</p>
            <p class="text-gray-500 text-sm mt-1">This user hasn't purchased any tickets yet</p>
          </div>
        </ng-template>
      </div>

      <!-- Waitlist Tokens Tab -->
      <div *ngIf="!loadingUserDetails() && isTokensTabActive()">
        <div *ngIf="userTokens().length > 0; else noTokensTemplate" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div *ngFor="let token of userTokens()" class="bg-gray-700/50 rounded-lg p-4 border border-gray-600">
            <div class="flex justify-between items-start mb-3">
              <div>
                <h5 class="font-semibold text-white">{{ token.customtokenid }}</h5>
                <span class="inline-flex items-center px-3 py-0.5 rounded-full text-xs font-medium" 
                      [class]="token.status === 'active' ? 'status-badge-approved' : token.status === 'expired' ? 'status-badge-rejected' : 'status-badge-inactive'">
                  {{ token.status }}
                </span>
              </div>
            </div>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-400">Amount Paid:</span>
                <span class="text-white font-medium">₹{{ token.amountpaid | number }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Created:</span>
                <span class="text-white">{{ formatDate(token.date || token.createdAt) }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Expires:</span>
                <span class="text-white">{{ formatDate(token.expirydate) }}</span>
              </div>
            </div>
          </div>
        </div>
        <ng-template #noTokensTemplate>
          <div class="text-center py-12">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mx-auto text-gray-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
            </svg>
            <p class="text-gray-400 font-medium">No waitlist tokens found</p>
            <p class="text-gray-500 text-sm mt-1">This user hasn't purchased any waitlist tokens yet</p>
          </div>
        </ng-template>
      </div>

      <!-- Book Now Tokens Tab -->
      <div *ngIf="!loadingUserDetails() && isBookNowTokensTabActive()">
        <div *ngIf="userBookNowTokens().length > 0; else noBookNowTokensTemplate" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div *ngFor="let token of userBookNowTokens()" class="bg-gray-700/50 rounded-lg p-4 border border-gray-600">
            <div class="flex justify-between items-start mb-3">
              <div>
                <h5 class="font-semibold text-white">{{ token.customtokenid }}</h5>
                <span class="inline-flex items-center px-3 py-0.5 rounded-full text-xs font-medium" 
                      [class]="token.status === 'active' ? 'status-badge-approved' : token.status === 'expired' ? 'status-badge-rejected' : 'status-badge-inactive'">
                  {{ token.status }}
                </span>
              </div>
            </div>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-400">Amount Paid:</span>
                <span class="text-white font-medium">₹{{ token.amountpaid | number }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Created:</span>
                <span class="text-white">{{ formatDate(token.date || token.createdAt) }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-400">Expires:</span>
                <span class="text-white">{{ formatDate(token.expirydate) }}</span>
              </div>
            </div>
          </div>
        </div>
        <ng-template #noBookNowTokensTemplate>
          <div class="text-center py-12">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mx-auto text-gray-500 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <p class="text-gray-400 font-medium">No book now tokens found</p>
            <p class="text-gray-500 text-sm mt-1">This user hasn't purchased any book now tokens yet</p>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>

<!-- Loading Dialog -->
<app-loading-dialog
  [visible]="showLoadingDialog"
  [title]="loadingMessage"
  [message]="loadingMessage"
  [allowCancel]="false">
</app-loading-dialog>

<!-- Reject KYC Modal -->
<div *ngIf="showRejectModal()" class="fixed inset-0 bg-gray-900/90 backdrop-blur-sm overflow-y-auto h-full w-full z-[80]">
  <div class="relative top-10 mx-auto p-6 w-full max-w-lg shadow-2xl rounded-2xl bg-gray-800 border border-gray-700">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-semibold text-white">Reject KYC Request</h3>
      <button (click)="closeModals()" class="text-gray-400 hover:text-white transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    
    <div *ngIf="selectedUser()">
      <p class="text-sm text-gray-300 mb-4">
        Reject KYC request for <strong class="text-white">{{ selectedUser()!.name }}</strong> ({{ selectedUser()!.email }})
      </p>
      
      <div>
        <label for="rejection-comment" class="block text-sm font-medium text-gray-300 mb-2">
          Rejection Reason <span class="text-red-400">*</span>
        </label>
        <textarea
          id="rejection-comment"
          [ngModel]="rejectionComment()"
          (ngModelChange)="rejectionComment.set($event)"
          rows="4"
          placeholder="Please provide a detailed reason for rejection..."
          class="block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
        </textarea>
      </div>
    </div>
    
    <div class="flex justify-end space-x-3 mt-6">
      <button
        (click)="closeModals()"
        class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors duration-200">
        Cancel
      </button>
      <button
        (click)="rejectKyc()"
        [disabled]="!rejectionComment().trim() || isLoading()"
        class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
        {{ isLoading() ? 'Rejecting...' : 'Reject KYC' }}
      </button>
    </div>
  </div>
</div>

<!-- Add User Modal -->
<div *ngIf="showAddUserModal()" class="fixed inset-0 bg-gray-900/90 backdrop-blur-sm overflow-y-auto h-full w-full z-[80]">
  <div class="relative top-10 mx-auto p-6 w-full max-w-2xl shadow-2xl rounded-2xl bg-gray-800 border border-gray-700">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-semibold text-white">Add New User</h3>
      <button (click)="closeModals()" class="text-gray-400 hover:text-white transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <form (ngSubmit)="saveUser()" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Name *</label>
          <input
            type="text"
            [ngModel]="userForm.name"
            (ngModelChange)="updateUserFormField('name', $event)"
            name="name"
            required
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            placeholder="Enter full name"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Email *</label>
          <input
            type="email"
            [ngModel]="userForm.email"
            (ngModelChange)="updateUserFormField('email', $event)"
            name="email"
            required
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            placeholder="Enter email address"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Password *</label>
          <input
            type="password"
            [ngModel]="userForm.password"
            (ngModelChange)="updateUserFormField('password', $event)"
            name="password"
            required
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            placeholder="Enter password"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Phone</label>
          <input
            type="tel"
            [ngModel]="userForm.phone"
            (ngModelChange)="updateUserFormField('phone', $event)"
            name="phone"
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            placeholder="Enter phone number"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Date of Birth</label>
          <input
            type="date"
            [ngModel]="userForm.dateofbirth"
            (ngModelChange)="updateUserFormField('dateofbirth', $event)"
            name="dateofbirth"
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            (click)="openDatePicker('userFormDateOfBirth')"
            id="userFormDateOfBirth"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Location</label>
          <input
            type="text"
            [ngModel]="userForm.location"
            (ngModelChange)="updateUserFormField('location', $event)"
            name="location"
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            placeholder="Enter location"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Pincode</label>
          <input
            type="text"
            [ngModel]="userForm.pincode"
            (ngModelChange)="updateUserFormField('pincode', $event)"
            name="pincode"
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            placeholder="Enter pincode"
          />
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">Address</label>
        <textarea
          [ngModel]="userForm.address"
          (ngModelChange)="updateUserFormField('address', $event)"
          name="address"
          rows="3"
          class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          placeholder="Enter full address"
        ></textarea>
      </div>
      
      <div class="flex justify-end space-x-3 pt-4">
        <button
          type="button"
          (click)="closeModals()"
          class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors duration-200"
        >
          Cancel
        </button>
        <button
          type="submit"
          [disabled]="!userForm.name.trim() || !userForm.email.trim() || isLoading()"
          class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {{ isLoading() ? 'Creating...' : 'Create User' }}
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit User Modal -->
<div *ngIf="showEditUserModal()" class="fixed inset-0 bg-gray-900/90 backdrop-blur-sm overflow-y-auto h-full w-full z-[80]">
  <div class="relative top-10 mx-auto p-6 w-full max-w-2xl shadow-2xl rounded-2xl bg-gray-800 border border-gray-700">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-semibold text-white">Edit User</h3>
      <button (click)="closeModals()" class="text-gray-400 hover:text-white transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <form (ngSubmit)="saveUser()" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Name *</label>
          <input
            type="text"
            [ngModel]="userForm.name"
            (ngModelChange)="updateUserFormField('name', $event)"
            name="name"
            required
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            placeholder="Enter full name"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Email *</label>
          <input
            type="email"
            [ngModel]="userForm.email"
            (ngModelChange)="updateUserFormField('email', $event)"
            name="email"
            required
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            placeholder="Enter email address"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">New Password (optional)</label>
          <input
            type="password"
            [ngModel]="userForm.password"
            (ngModelChange)="updateUserFormField('password', $event)"
            name="password"
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            placeholder="Enter new password (leave blank to keep current)"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Phone</label>
          <input
            type="tel"
            [ngModel]="userForm.phone"
            (ngModelChange)="updateUserFormField('phone', $event)"
            name="phone"
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            placeholder="Enter phone number"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Date of Birth</label>
          <input
            type="date"
            [ngModel]="userForm.dateofbirth"
            (ngModelChange)="updateUserFormField('dateofbirth', $event)"
            name="dateofbirth"
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            (click)="openDatePicker('userFormDateOfBirth')"
            id="userFormDateOfBirth"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Location</label>
          <input
            type="text"
            [ngModel]="userForm.location"
            (ngModelChange)="updateUserFormField('location', $event)"
            name="location"
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            placeholder="Enter location"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">Pincode</label>
          <input
            type="text"
            [ngModel]="userForm.pincode"
            (ngModelChange)="updateUserFormField('pincode', $event)"
            name="pincode"
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 cursor-pointer"
            placeholder="Enter pincode"
          />
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">Address</label>
        <textarea
          [ngModel]="userForm.address"
          (ngModelChange)="updateUserFormField('address', $event)"
          name="address"
          rows="3"
          class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          placeholder="Enter full address"
        ></textarea>
      </div>
      
      <!-- KYC Document Upload -->
      <div>
        <label class="block text-sm font-medium text-gray-300 mb-2">KYC Documents (PDF)</label>
        <div class="space-y-3">
          <input
            type="file"
            id="kycFileInput"
            accept=".pdf"
            (change)="onKycFileSelected($event)"
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          />
          <p class="text-xs text-gray-400">
            Upload all identity documents in a single PDF file (Max 10MB)
          </p>
          <div *ngIf="userForm.kycFile" class="flex items-center justify-between p-3 bg-gray-700 rounded-lg border border-gray-600">
            <div class="flex items-center space-x-2">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-red-500">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
              </svg>
              <span class="text-sm text-white">{{ userForm.kycFile.name }}</span>
              <span class="text-xs text-gray-400">({{ (userForm.kycFile.size / 1024 / 1024).toFixed(2) }} MB)</span>
            </div>
            <button
              type="button"
              (click)="removeKycFile()"
              class="text-red-400 hover:text-red-300 transition-colors duration-200"
            >
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </div>
      </div>
      
      <div class="flex justify-end space-x-3 pt-4">
        <button
          type="button"
          (click)="closeModals()"
          class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors duration-200"
        >
          Cancel
        </button>
        <button
          type="submit"
          [disabled]="!userForm.name.trim() || !userForm.email.trim() || isLoading()"
          class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {{ isLoading() ? 'Updating...' : 'Update User' }}
        </button>
      </div>
    </form>
  </div>
</div>
<!-- Status Management Modal -->
<div *ngIf="showStatusModal()" class="fixed inset-0 bg-gray-900/90 backdrop-blur-sm overflow-y-auto h-full w-full z-[80]">
  <div class="relative top-10 mx-auto p-6 w-full max-w-lg shadow-2xl rounded-2xl bg-gray-800 border border-gray-700">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-semibold text-white">
        {{ statusAction() === 'suspend' ? 'Suspend User' : statusAction() === 'deactivate' ? 'Deactivate User' : 'Reactivate User' }}
      </h3>
      <button (click)="closeModals()" class="text-gray-400 hover:text-white transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    
    <div *ngIf="selectedUser()">
      <p class="text-sm text-gray-300 mb-4">
        {{ statusAction() === 'suspend' ? 'Suspend' : statusAction() === 'deactivate' ? 'Deactivate' : 'Reactivate' }} user 
        <strong class="text-white">{{ selectedUser()!.name }}</strong> ({{ selectedUser()!.email }})
      </p>
      
      <div *ngIf="statusAction() === 'suspend'" class="mb-4 p-3 bg-yellow-900/20 border border-yellow-600/50 rounded-lg">
        <p class="text-sm text-yellow-300">
          <i class="fas fa-info-circle mr-2"></i>
          This user will be suspended for 7 days and will be automatically reactivated.
        </p>
      </div>
      
      <div *ngIf="statusAction() === 'deactivate'" class="mb-4 p-3 bg-red-900/20 border border-red-600/50 rounded-lg">
        <p class="text-sm text-red-300">
          <i class="fas fa-exclamation-triangle mr-2"></i>
          This user will be deactivated and will remain so until manually reactivated.
        </p>
      </div>
      
      <div>
        <label for="status-reason" class="block text-sm font-medium text-gray-300 mb-2">
          Reason <span class="text-red-400">*</span>
        </label>
        <textarea
          id="status-reason"
          [ngModel]="statusReason()"
          (ngModelChange)="statusReason.set($event)"
          rows="4"
          placeholder="Please provide a detailed reason for this action..."
          class="block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
        </textarea>
      </div>
    </div>
    
    <div class="flex justify-end space-x-3 mt-6">
      <button
        (click)="closeModals()"
        class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors duration-200">
        Cancel
      </button>
      <button
        (click)="performStatusAction()"
        [disabled]="!statusReason().trim() || isLoading()"
        [class]="statusAction() === 'suspend' ? 'px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed' : 
                 statusAction() === 'deactivate' ? 'px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed' : 
                 'px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed'">
        {{ isLoading() ? 'Processing...' : (statusAction() === 'suspend' ? 'Suspend User' : statusAction() === 'deactivate' ? 'Deactivate User' : 'Reactivate User') }}
      </button>
    </div>
  </div>
</div>

<!-- Status History Modal -->
<div *ngIf="showStatusHistoryModal()" class="fixed inset-0 bg-gray-900/90 backdrop-blur-sm overflow-y-auto h-full w-full z-[80]">
  <div class="relative top-10 mx-auto p-6 w-full max-w-2xl shadow-2xl rounded-2xl bg-gray-800 border border-gray-700">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-semibold text-white">User Status History</h3>
      <button (click)="closeModals()" class="text-gray-400 hover:text-white transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    
    <div *ngIf="selectedUser() && statusHistory()" class="space-y-6">
      <div class="bg-gray-700/50 rounded-lg p-6 border border-gray-600">
        <h4 class="text-lg font-semibold text-white mb-4">Current Status</h4>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <p class="text-sm text-gray-400">Status</p>
            <span class="inline-flex items-center rounded-full px-3 py-0.5 text-xs font-medium" 
                  [class]="getStatusClass(statusHistory().currentStatus)">
              <span class="mr-1">{{ getStatusIcon(statusHistory().currentStatus) }}</span>
              {{ statusHistory().currentStatus }}
            </span>
          </div>
          <div *ngIf="statusHistory().suspensionEndDate">
            <p class="text-sm text-gray-400">Suspension Ends</p>
            <p class="font-medium text-white">{{ formatSuspensionEndDate(statusHistory().suspensionEndDate) }}</p>
          </div>
        </div>
        
        <div *ngIf="statusHistory().suspensionReason" class="mt-4">
          <p class="text-sm text-gray-400">Suspension Reason</p>
          <p class="text-white">{{ statusHistory().suspensionReason }}</p>
        </div>
        
        <div *ngIf="statusHistory().deactivationReason" class="mt-4">
          <p class="text-sm text-gray-400">Deactivation Reason</p>
          <p class="text-white">{{ statusHistory().deactivationReason }}</p>
        </div>
        
        <div *ngIf="statusHistory().statusChangedBy" class="mt-4">
          <p class="text-sm text-gray-400">Last Changed By</p>
          <p class="text-white">{{ statusHistory().statusChangedBy.name }} ({{ statusHistory().statusChangedBy.role }})</p>
          <p class="text-xs text-gray-400">{{ formatDate(statusHistory().statusChangedAt) }}</p>
        </div>
        
        <div class="mt-4">
          <p class="text-sm text-gray-400">Account Created</p>
          <p class="text-white">{{ formatDate(statusHistory().accountCreatedAt) }}</p>
        </div>
      </div>
    </div>
    
    <div class="flex justify-end space-x-3 mt-6">
      <button
        (click)="closeModals()"
        class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors duration-200">
        Close
      </button>
    </div>
  </div>
</div>

<!-- Suspension Statistics Modal -->
<div *ngIf="showSuspensionStatsModal()" class="fixed inset-0 bg-gray-900/90 backdrop-blur-sm overflow-y-auto h-full w-full z-[80]">
  <div class="relative top-10 mx-auto p-6 w-full max-w-2xl shadow-2xl rounded-2xl bg-gray-800 border border-gray-700">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-semibold text-white">Suspension Statistics</h3>
      <button (click)="closeModals()" class="text-gray-400 hover:text-white transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    
    <div *ngIf="suspensionStats()" class="grid grid-cols-2 md:grid-cols-3 gap-4">
      <div class="bg-gray-700/50 rounded-lg p-4 border border-gray-600">
        <div class="flex items-center">
          <div class="w-3 h-3 bg-green-400 rounded-full mr-2"></div>
          <span class="text-sm text-gray-300">Total Users</span>
        </div>
        <div class="text-2xl font-bold text-white mt-2">{{ suspensionStats().totalUsers }}</div>
      </div>
      
      <div class="bg-gray-700/50 rounded-lg p-4 border border-gray-600">
        <div class="flex items-center">
          <div class="w-3 h-3 bg-green-400 rounded-full mr-2"></div>
          <span class="text-sm text-gray-300">Active</span>
        </div>
        <div class="text-2xl font-bold text-white mt-2">{{ suspensionStats().active }}</div>
      </div>
      
      <div class="bg-gray-700/50 rounded-lg p-4 border border-gray-600">
        <div class="flex items-center">
          <div class="w-3 h-3 bg-yellow-400 rounded-full mr-2"></div>
          <span class="text-sm text-gray-300">Suspended</span>
        </div>
        <div class="text-2xl font-bold text-white mt-2">{{ suspensionStats().suspended }}</div>
      </div>
      
      <div class="bg-gray-700/50 rounded-lg p-4 border border-gray-600">
        <div class="flex items-center">
          <div class="w-3 h-3 bg-red-400 rounded-full mr-2"></div>
          <span class="text-sm text-gray-300">Deactivated</span>
        </div>
        <div class="text-2xl font-bold text-white mt-2">{{ suspensionStats().deactivated }}</div>
      </div>
      
      <div class="bg-gray-700/50 rounded-lg p-4 border border-gray-600">
        <div class="flex items-center">
          <div class="w-3 h-3 bg-blue-400 rounded-full mr-2"></div>
          <span class="text-sm text-gray-300">Expired Suspensions</span>
        </div>
        <div class="text-2xl font-bold text-white mt-2">{{ suspensionStats().expiredSuspensions }}</div>
      </div>
    </div>
    
    <div class="flex justify-end space-x-3 mt-6">
      <button
        (click)="closeModals()"
        class="px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors duration-200">
        Close
      </button>
    </div>
  </div>
</div>
