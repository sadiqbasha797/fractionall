<div class="flex-1 flex flex-col min-h-screen bg-gray-700 text-gray-100">
  <!-- Enhanced Header Section -->
  <header class="bg-gradient-to-r from-gray-800 to-gray-700 border-b border-gray-600 shadow-lg">
    <!-- Title and Stats Section -->
    <div class="px-4 sm:px-6 py-4 sm:py-6 border-b border-gray-600/50">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        <!-- Title Section -->
        <div class="flex items-center space-x-3">
          <div class="p-2 bg-purple-600/20 rounded-lg">
            <i class="fas fa-file-contract text-purple-400 text-xl"></i>
          </div>
          <div>
            <h1 class="text-2xl sm:text-3xl font-bold text-white">Manage LLP & Purchase</h1>
            <p class="text-gray-400 text-sm mt-1">Create and manage user LLP & purchase agreements with document uploads</p>
          </div>
        </div>
        
        <!-- Stats Cards -->
        <div class="flex items-center space-x-3 sm:space-x-4">
          <div class="bg-gray-700/50 backdrop-blur-sm rounded-xl px-3 sm:px-4 py-2 sm:py-3 border border-gray-600/50 flex-1 sm:flex-none">
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
              <span class="text-xs sm:text-sm text-gray-300">Total LLP & Purchase</span>
            </div>
            <div class="text-xl sm:text-2xl font-bold text-white mt-1">{{contracts.length}}</div>
          </div>
          <div class="bg-gray-700/50 backdrop-blur-sm rounded-xl px-3 sm:px-4 py-2 sm:py-3 border border-gray-600/50 flex-1 sm:flex-none">
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
              <span class="text-xs sm:text-sm text-gray-300">Filtered</span>
            </div>
            <div class="text-xl sm:text-2xl font-bold text-white mt-1">{{filteredContracts.length}}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Search and Filters Section -->
    <div class="px-4 sm:px-6 py-4 sm:py-6">
      <div class="flex flex-col gap-4">
        <!-- Search Bar -->
        <div class="w-full">
          <label class="block text-sm font-medium text-gray-300 mb-2">Search LLP & Purchase</label>
          <div class="relative search-input-container">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-search search-icon"></i>
            </div>
            <input 
              type="search" 
              [(ngModel)]="searchTerm" 
              (ngModelChange)="onSearchChange()"
              placeholder="Search by user name, car name, ticket ID, or LLP & purchase ID..."
              class="w-full pl-10 pr-4 py-2.5 bg-gray-800/50 border border-gray-600/50 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50 transition-all duration-200 backdrop-blur-sm"
            />
          </div>
        </div>

        <!-- Filters and Actions Row -->
        <div class="flex flex-col sm:flex-row gap-4">
          <!-- Filters Group -->
          <div class="flex flex-col sm:flex-row gap-4 flex-1">
            <div class="flex-1 min-w-0">
              <label class="block text-sm font-medium text-gray-300 mb-2">Created By</label>
              <select 
                [(ngModel)]="createdByFilter" 
                (ngModelChange)="onCreatedByFilterChange()"
                class="w-full px-3 py-2.5 bg-gray-800/50 border border-gray-600/50 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50 transition-all duration-200 backdrop-blur-sm"
              >
                <option value="all">All Creators</option>
                <option value="Admin">Admin</option>
                <option value="SuperAdmin">Super Admin</option>
              </select>
            </div>

            <div class="flex-1 min-w-0">
              <label class="block text-sm font-medium text-gray-300 mb-2">Has Documents</label>
              <select 
                [(ngModel)]="documentsFilter" 
                (ngModelChange)="onDocumentsFilterChange()"
                class="w-full px-3 py-2.5 bg-gray-800/50 border border-gray-600/50 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500/50 focus:border-purple-500/50 transition-all duration-200 backdrop-blur-sm"
              >
                <option value="all">All LLP & Purchase</option>
                <option value="with-docs">With Documents</option>
                <option value="without-docs">Without Documents</option>
              </select>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex items-end gap-2 sm:ml-auto">
            <button 
              (click)="clearFilters()" 
              class="inline-flex items-center justify-center gap-1.5 px-3 py-2.5 bg-gray-700/50 hover:bg-gray-600/50 border border-gray-600/50 rounded-lg text-gray-300 hover:text-white text-sm font-medium transition-all duration-200 backdrop-blur-sm hover:border-gray-500/50 h-10"
            >
              <i class="fas fa-times text-sm"></i>
              <span>Clear</span>
            </button>

            <button 
              (click)="exportData()" 
              class="inline-flex items-center justify-center gap-1.5 px-3 py-2.5 bg-gray-700/50 hover:bg-gray-600/50 border border-gray-600/50 rounded-lg text-gray-300 hover:text-white text-sm font-medium transition-all duration-200 backdrop-blur-sm hover:border-gray-500/50 h-10"
            >
              <i class="fas fa-download text-sm"></i>
              <span>Export</span>
            </button>

            <button 
              (click)="showCreateContractModal()" 
              class="inline-flex items-center justify-center gap-1.5 px-4 py-2.5 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 rounded-lg text-white text-sm font-medium shadow-sm hover:shadow-md transition-all duration-200 transform hover:scale-105 h-10"
            >
              <i class="fas fa-plus text-sm"></i>
              <span>Create LLP & Purchase</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="flex-1 py-4 overflow-auto">
    <section class="max-w-7xl mx-auto">
      <div class="h-full rounded-xl border border-gray-700 bg-gray-900 shadow-sm min-w-0">
        <!-- Scrollable table container -->
        <div class="overflow-x-auto overflow-y-auto no-scrollbar" style="max-height: 72vh;">
          <table class="min-w-full divide-y divide-gray-700" role="table" aria-label="LLP & Purchase table">
            <thead>
              <tr class="bg-gray-800">
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider" scope="col">LLP & Purchase ID</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider" scope="col">User</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider" scope="col">Car</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider" scope="col">Ticket</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider" scope="col">Documents</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider" scope="col">Created By</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider" scope="col">Created Date</th>
                <th class="px-6 py-3 text-center text-xs font-medium text-gray-300 uppercase tracking-wider" scope="col">Actions</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-700 bg-gray-900">
              <tr *ngIf="filteredContracts.length === 0" class="text-center">
                <td colspan="8" class="px-6 py-12 text-gray-400">
                  <div class="flex flex-col items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 mb-4 text-gray-500">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0-1.125-.504-1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                    </svg>
                    <p class="text-lg font-medium text-gray-500 mb-2">No LLP & purchase agreements found</p>
                    <p class="text-sm text-gray-400">Try adjusting your search or filter criteria</p>
                  </div>
                </td>
              </tr>
              
              <tr *ngFor="let contract of filteredContracts" class="hover:bg-gray-800 transition duration-150">
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium text-gray-100 font-mono">{{ getContractDisplayId(contract._id) }}</div>
                </td>
                
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="h-10 w-10 flex-shrink-0">
                      <div class="h-10 w-10 rounded-full bg-purple-600 flex items-center justify-center">
                        <span class="text-sm font-medium text-white">{{ getUserInitials(contract.userid) }}</span>
                      </div>
                    </div>
                    <div class="ml-4">
                      <div class="text-sm font-medium text-gray-100">{{ getUserName(contract.userid) }}</div>
                      <div class="text-sm text-gray-300">{{ getUserEmail(contract.userid) }}</div>
                    </div>
                  </div>
                </td>
                
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="h-10 w-10 flex-shrink-0 overflow-hidden rounded-lg border border-gray-700" *ngIf="getCarImage(contract.carid)">
                      <img [src]="getCarImage(contract.carid)" [alt]="getCarName(contract.carid)" class="h-10 w-10 object-cover" />
                    </div>
                    <div class="h-10 w-10 flex-shrink-0 bg-gray-600 rounded-lg flex items-center justify-center" *ngIf="!getCarImage(contract.carid)">
                      <i class="fas fa-car text-gray-400"></i>
                    </div>
                    <div class="ml-4">
                      <div class="text-sm font-medium text-gray-100">{{ getCarName(contract.carid) }}</div>
                      <div class="text-sm text-gray-300">{{ getCarBrand(contract.carid) }}</div>
                    </div>
                  </div>
                </td>
                
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm text-gray-300">
                    <div class="font-medium text-gray-100">{{ getTicketId(contract.ticketid) }}</div>
                    <div class="text-sm text-gray-400">₹{{ getTicketPrice(contract.ticketid) | number:'1.0-0' }}</div>
                  </div>
                </td>
                
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium" 
                          [class]="contract.contract_docs && contract.contract_docs.length > 0 ? 'bg-green-900/50 text-green-300 border border-green-700' : 'bg-red-900/50 text-red-300 border border-red-700'">
                      <i class="fas" [class]="contract.contract_docs && contract.contract_docs.length > 0 ? 'fa-check mr-1' : 'fa-times mr-1'"></i>
                      {{ contract.contract_docs ? contract.contract_docs.length : 0 }} docs
                    </span>
                  </div>
                </td>
                
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium" 
                        [class]="contract.createdByModel === 'SuperAdmin' ? 'bg-yellow-900/50 text-yellow-300 border border-yellow-700' : 'bg-blue-900/50 text-blue-300 border border-blue-700'">
                    {{ contract.createdByModel }}
                  </span>
                </td>
                
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                  {{ formatDate(contract.createdat || contract.createdAt) }}
                </td>
                
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                  <div class="flex items-center justify-end space-x-2">
                    <button class="p-2 text-gray-300 hover:text-blue-300 rounded-lg hover:bg-gray-800 transition duration-150 focus:outline-none focus:ring-2 focus:ring-blue-300" 
                            (click)="viewContractDetails(contract)" title="View Details" [attr.aria-label]="'View contract details'">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                      </svg>
                    </button>
                    
                    <button class="p-2 text-gray-300 hover:text-green-400 rounded-lg hover:bg-gray-800 transition duration-150 focus:outline-none focus:ring-2 focus:ring-green-200" 
                            (click)="manageDocuments(contract)" title="Manage Documents" [attr.aria-label]="'Manage documents for this contract'">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 0 0-1.883 2.542l.857 6a2.25 2.25 0 0 0 2.227 1.932H19.05a2.25 2.25 0 0 0 2.227-1.932l.857-6a2.25 2.25 0 0 0-1.883-2.542m-16.5 0V6A2.25 2.25 0 0 1 6 3.75h3.879a1.5 1.5 0 0 1 1.06.44l2.122 2.12a1.5 1.5 0 0 0 1.06.44H18A2.25 2.25 0 0 1 20.25 9v.776" />
                      </svg>
                    </button>
                    
                    <button class="p-2 text-gray-300 hover:text-amber-400 rounded-lg hover:bg-gray-800 transition duration-150 focus:outline-none focus:ring-2 focus:ring-amber-200" 
                            (click)="editContract(contract)" title="Edit" [attr.aria-label]="'Edit contract'">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.862 4.487Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" />
                      </svg>
                    </button>
                    
                    <button class="p-2 text-gray-300 hover:text-red-400 rounded-lg hover:bg-gray-800 transition duration-150 focus:outline-none focus:ring-2 focus:ring-red-200" 
                            (click)="deleteContract(contract)" title="Delete" [attr.aria-label]="'Delete contract'">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" />
                      </svg>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <!-- Pagination -->
        <div class="flex items-center justify-between border-t border-gray-700 bg-gray-900 px-6 py-4">
          <div class="flex items-center space-x-2 text-sm text-gray-300">
            <span>Showing</span>
            <span class="font-medium text-gray-100">1</span>
            <span>to</span>
            <span class="font-medium text-gray-100">{{ filteredContracts.length }}</span>
            <span>of</span>
            <span class="font-medium text-gray-100">{{ contracts.length }}</span>
            <span>contracts</span>
          </div>
          <div class="flex items-center space-x-2">
            <button class="inline-flex items-center justify-center rounded-lg border border-gray-700 px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition duration-150">
              Previous
            </button>
            <button class="inline-flex items-center justify-center rounded-lg border border-gray-700 px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition duration-150">
              Next
            </button>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- Create/Edit Contract Modal -->
<div *ngIf="showCreateEditModal" class="modal fixed inset-0 bg-gray-900/80 backdrop-blur-sm overflow-y-auto h-full w-full z-50">
  <div class="relative top-10 mx-auto p-6 w-full max-w-4xl shadow-2xl rounded-2xl bg-gray-800 border border-gray-700">
    <div class="mt-3">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-semibold text-white">{{ isEditMode ? 'Edit Contract' : 'Create New Contract' }}</h3>
        <button (click)="closeCreateEditModal()" class="text-gray-400 hover:text-white transition-colors duration-200">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <div class="mt-2">
        <form (ngSubmit)="submitContractForm()" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- User Selection -->
            <div class="space-y-2">
              <label class="block text-gray-300 text-sm font-medium" for="userid">
                Select User <span class="text-red-400">*</span>
              </label>
              <select class="w-full bg-gray-700 border border-gray-600 rounded-lg py-2.5 px-4 text-white
                           focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200" 
                      id="userid" [(ngModel)]="contractData.userid" name="userid" required>
                <option value="">Choose a user...</option>
                <option *ngFor="let user of users" [value]="user._id">{{ user.name }} ({{ user.email }})</option>
              </select>
            </div>

            <!-- Car Selection -->
            <div class="space-y-2">
              <label class="block text-gray-300 text-sm font-medium" for="carid">
                Select Car <span class="text-red-400">*</span>
              </label>
              <select class="w-full bg-gray-700 border border-gray-600 rounded-lg py-2.5 px-4 text-white
                           focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200" 
                      id="carid" [(ngModel)]="contractData.carid" name="carid" required (ngModelChange)="onCarChange($event)">
                <option value="">Choose a car...</option>
                <option *ngFor="let car of cars" [value]="car._id">{{ car.carname }} - {{ car.brandname }}</option>
              </select>
            </div>

            <!-- Ticket Selection -->
            <div class="space-y-2">
              <label class="block text-gray-300 text-sm font-medium" for="ticketid">
                Select Ticket <span class="text-red-400">*</span>
              </label>
              <select class="w-full bg-gray-700 border border-gray-600 rounded-lg py-2.5 px-4 text-white
                           focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all duration-200" 
                      id="ticketid" [(ngModel)]="contractData.ticketid" name="ticketid" required>
                <option value="">Choose a ticket...</option>
                <option *ngFor="let ticket of availableTickets" [value]="ticket._id">
                  {{ ticket.ticketcustomid }} - ₹{{ ticket.ticketprice | number:'1.0-0' }}
                </option>
              </select>
            </div>
          </div>

          <!-- Contract Documents Upload -->
          <div class="space-y-2" *ngIf="!isEditMode">
            <label class="block text-gray-300 text-sm font-medium" for="contract_docs">
              Contract Documents (Optional)
            </label>
            <div class="flex items-center justify-center w-full">
              <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-700 hover:bg-gray-600 transition-colors duration-200">
                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                  <svg class="w-8 h-8 mb-4 text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
                  </svg>
                  <p class="mb-2 text-sm text-gray-400">Click to upload contract documents</p>
                  <p class="text-xs text-gray-400">PDF files only (Max 5 files)</p>
                </div>
                <input id="contract_docs" type="file" class="hidden" multiple accept=".pdf" (change)="onFilesSelected($event)" name="contract_docs" />
              </label>
            </div>
            
            <!-- Selected Files Display -->
            <div *ngIf="selectedFiles.length > 0" class="mt-4">
              <h4 class="text-sm font-medium text-gray-300 mb-2">Selected Files:</h4>
              <div class="space-y-2">
                <div *ngFor="let file of selectedFiles; let i = index" class="flex items-center justify-between bg-gray-700/50 rounded-lg p-3">
                  <div class="flex items-center space-x-2">
                    <i class="fas fa-file-pdf text-red-400"></i>
                    <span class="text-sm text-gray-300">{{ file.name }}</span>
                    <span class="text-xs text-gray-400">({{ formatFileSize(file.size) }})</span>
                  </div>
                  <button type="button" (click)="removeFile(i)" class="text-red-400 hover:text-red-300 transition-colors duration-200">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="flex items-center justify-end space-x-4 mt-6">
            <button type="button" 
                    (click)="closeCreateEditModal()"
                    class="px-6 py-2.5 rounded-lg border border-gray-600 text-gray-300 hover:bg-gray-600 transition-colors duration-200">
              Cancel
            </button>
            <button type="submit"
                    [disabled]="isSubmitting"
                    class="px-6 py-2.5 rounded-lg bg-purple-500 text-white hover:bg-purple-600 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
              <span *ngIf="isSubmitting" class="inline-flex items-center">
                <svg class="animate-spin -ml-1 mr-3 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Processing...
              </span>
              <span *ngIf="!isSubmitting">{{ isEditMode ? 'Update Contract' : 'Create Contract' }}</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- View Contract Details Modal -->
<div *ngIf="selectedContract" class="fixed inset-0 bg-gray-900/90 backdrop-blur-sm overflow-y-auto h-full w-full z-50">
  <div class="relative top-10 mx-auto p-6 w-full max-w-5xl shadow-2xl rounded-2xl bg-gray-800 border border-gray-700">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-semibold text-white">Contract Details</h3>
      <button (click)="closeViewModal()" class="text-gray-400 hover:text-white transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Contract Information -->
      <div class="space-y-6">
        <div class="bg-gray-700/50 rounded-lg p-6 border border-gray-600">
          <h4 class="text-lg font-semibold text-white mb-4">Contract Information</h4>
          <div class="space-y-3">
            <div>
              <p class="text-sm text-gray-400">Contract ID</p>
              <p class="font-medium text-white font-mono">{{ getContractDisplayId(selectedContract._id) }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-400">Created By</p>
              <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-sm font-medium" 
                    [class]="selectedContract.createdByModel === 'SuperAdmin' ? 'bg-yellow-900/50 text-yellow-300 border border-yellow-700' : 'bg-blue-900/50 text-blue-300 border border-blue-700'">
                {{ selectedContract.createdByModel }}
              </span>
            </div>
            <div>
              <p class="text-sm text-gray-400">Created Date</p>
              <p class="font-medium text-white">{{ formatDate(selectedContract.createdat || selectedContract.createdAt) }}</p>
            </div>
          </div>
        </div>

        <!-- User Information -->
        <div class="bg-gray-700/50 rounded-lg p-6 border border-gray-600">
          <h4 class="text-lg font-semibold text-white mb-4">User Information</h4>
          <div class="flex items-center space-x-4">
            <div class="h-12 w-12 rounded-full bg-purple-600 flex items-center justify-center">
              <span class="text-lg font-medium text-white">{{ getUserInitials(selectedContract.userid) }}</span>
            </div>
            <div>
              <p class="font-medium text-white">{{ getUserName(selectedContract.userid) }}</p>
              <p class="text-sm text-gray-300">{{ getUserEmail(selectedContract.userid) }}</p>
            </div>
          </div>
        </div>

        <!-- Car Information -->
        <div class="bg-gray-700/50 rounded-lg p-6 border border-gray-600">
          <h4 class="text-lg font-semibold text-white mb-4">Car Information</h4>
          <div class="flex items-center space-x-4">
            <div class="h-20 w-20 flex-shrink-0 overflow-hidden rounded-lg border border-gray-700" *ngIf="getCarImage(selectedContract.carid)">
              <img [src]="getCarImage(selectedContract.carid)" [alt]="getCarName(selectedContract.carid)" class="h-20 w-20 object-cover" />
            </div>
            <div class="h-20 w-20 flex-shrink-0 bg-gray-600 rounded-lg flex items-center justify-center" *ngIf="!getCarImage(selectedContract.carid)">
              <i class="fas fa-car text-gray-400 text-2xl"></i>
            </div>
            <div>
              <p class="font-medium text-white text-lg">{{ getCarName(selectedContract.carid) }}</p>
              <p class="text-sm text-gray-300">{{ getCarBrand(selectedContract.carid) }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Ticket and Documents Information -->
      <div class="space-y-6">
        <!-- Ticket Information -->
        <div class="bg-gray-700/50 rounded-lg p-6 border border-gray-600">
          <h4 class="text-lg font-semibold text-white mb-4">Ticket Information</h4>
          <div class="space-y-3">
            <div>
              <p class="text-sm text-gray-400">Ticket ID</p>
              <p class="font-medium text-white">{{ getTicketId(selectedContract.ticketid) }}</p>
            </div>
            <div>
              <p class="text-sm text-gray-400">Ticket Price</p>
              <p class="font-medium text-white">₹{{ getTicketPrice(selectedContract.ticketid) | number:'1.0-0' }}</p>
            </div>
          </div>
        </div>

        <!-- Contract Documents -->
        <div class="bg-gray-700/50 rounded-lg p-6 border border-gray-600">
          <h4 class="text-lg font-semibold text-white mb-4">Contract Documents</h4>
          <div *ngIf="selectedContract.contract_docs && selectedContract.contract_docs.length > 0" class="space-y-3">
            <div *ngFor="let doc of selectedContract.contract_docs; let i = index" 
                 class="flex items-center justify-between bg-gray-800/50 rounded-lg p-3">
              <div class="flex items-center space-x-3">
                <i class="fas fa-file-pdf text-red-400"></i>
                <span class="text-sm text-gray-300">Contract Document {{ i + 1 }}</span>
              </div>
              <div class="flex items-center space-x-2">
                <button (click)="viewDocument(selectedContract._id!, i)" 
                        class="text-blue-400 hover:text-blue-300 text-sm">
                  <i class="fas fa-eye mr-1"></i>
                  View
                </button>
                <button (click)="downloadDocument(selectedContract._id!, i)" 
                        class="text-green-400 hover:text-green-300 text-sm">
                  <i class="fas fa-download mr-1"></i>
                  Download
                </button>
              </div>
            </div>
          </div>
          <div *ngIf="!selectedContract.contract_docs || selectedContract.contract_docs.length === 0" 
               class="text-center py-8">
            <i class="fas fa-file text-gray-500 text-3xl mb-2"></i>
            <p class="text-gray-400">No documents uploaded yet</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Document Management Modal -->
<div *ngIf="showDocumentModal" class="fixed inset-0 bg-gray-900/90 backdrop-blur-sm overflow-y-auto h-full w-full z-50">
  <div class="relative top-10 mx-auto p-6 w-full max-w-4xl shadow-2xl rounded-2xl bg-gray-800 border border-gray-700">
    <div class="flex justify-between items-center mb-6">
      <h3 class="text-2xl font-semibold text-white">Manage Contract Documents</h3>
      <button (click)="closeDocumentModal()" class="text-gray-400 hover:text-white transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Current Documents -->
    <div class="mb-8" *ngIf="currentContract">
      <h4 class="text-lg font-semibold text-white mb-4">Current Documents</h4>
      <div *ngIf="hasCurrentContractDocs" class="space-y-3">
        <div *ngFor="let doc of currentContractDocs; let i = index" 
             class="flex items-center justify-between bg-gray-800/50 rounded-lg p-3">
          <div class="flex items-center space-x-3">
            <input type="checkbox" [(ngModel)]="selectedDocuments[i]" 
                   class="w-4 h-4 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500">
            <i class="fas fa-file-pdf text-red-400"></i>
            <span class="text-sm text-gray-300">Document {{ i + 1 }}</span>
          </div>
          <div class="flex items-center space-x-2">
            <button (click)="viewDocument(getCurrentContractId()!, i)" 
                    class="text-blue-400 hover:text-blue-300 text-sm px-2 py-1 rounded transition-colors duration-200">
              <i class="fas fa-eye mr-1"></i>
              View
            </button>
            <button (click)="downloadDocument(getCurrentContractId()!, i)" 
                    class="text-green-400 hover:text-green-300 text-sm px-2 py-1 rounded transition-colors duration-200">
              <i class="fas fa-download mr-1"></i>
              Download
            </button>
          </div>
        </div>
      </div>
      <div *ngIf="!hasCurrentContractDocs" 
           class="text-center py-8 border-2 border-dashed border-gray-600 rounded-lg">
        <i class="fas fa-file text-gray-500 text-3xl mb-2"></i>
        <p class="text-gray-400">No documents uploaded yet</p>
      </div>

      <!-- Document Actions -->
      <div class="flex space-x-4 mt-4" *ngIf="hasCurrentContractDocs">
        <button (click)="deleteSelectedDocuments()" 
                [disabled]="!hasSelectedDocuments()" 
                class="px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg transition-colors duration-200">
          <i class="fas fa-trash mr-2"></i>
          Delete Selected
        </button>
      </div>
    </div>

    <!-- Upload New Documents -->
    <div class="mb-6">
      <h4 class="text-lg font-semibold text-white mb-4">Upload New Documents</h4>
      <div class="flex items-center justify-center w-full">
        <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-600 border-dashed rounded-lg cursor-pointer bg-gray-700 hover:bg-gray-600 transition-colors duration-200">
          <div class="flex flex-col items-center justify-center pt-5 pb-6">
            <svg class="w-8 h-8 mb-4 text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 16">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 13h3a3 3 0 0 0 0-6h-.025A5.56 5.56 0 0 0 16 6.5 5.5 5.5 0 0 0 5.207 5.021C5.137 5.017 5.071 5 5 5a4 4 0 0 0 0 8h2.167M10 15V6m0 0L8 8m2-2 2 2"/>
            </svg>
            <p class="mb-2 text-sm text-gray-400">Click to upload new documents</p>
            <p class="text-xs text-gray-400">PDF files only (Max 5 files)</p>
          </div>
          <input type="file" class="hidden" multiple accept=".pdf" (change)="onDocumentFilesSelected($event)" />
        </label>
      </div>
      
      <!-- New Files Display -->
      <div *ngIf="newDocumentFiles.length > 0" class="mt-4">
        <h5 class="text-sm font-medium text-gray-300 mb-2">Files to Upload:</h5>
        <div class="space-y-2">
          <div *ngFor="let file of newDocumentFiles; let i = index" class="flex items-center justify-between bg-gray-700/50 rounded-lg p-3">
            <div class="flex items-center space-x-2">
              <i class="fas fa-file-pdf text-red-400"></i>
              <span class="text-sm text-gray-300">{{ file.name }}</span>
              <span class="text-xs text-gray-400">({{ formatFileSize(file.size) }})</span>
            </div>
            <button type="button" (click)="removeNewDocumentFile(i)" class="text-red-400 hover:text-red-300 transition-colors duration-200">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Actions -->
    <div class="flex items-center justify-end space-x-4">
      <button (click)="closeDocumentModal()" 
              class="px-6 py-2.5 rounded-lg border border-gray-600 text-gray-300 hover:bg-gray-600 transition-colors duration-200">
        Cancel
      </button>
      <button (click)="uploadNewDocuments()" 
              [disabled]="newDocumentFiles.length === 0 || isUploading" 
              class="px-6 py-2.5 rounded-lg bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white transition-colors duration-200">
        <span *ngIf="isUploading" class="inline-flex items-center">
          <svg class="animate-spin -ml-1 mr-3 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Uploading...
        </span>
        <span *ngIf="!isUploading">
          <i class="fas fa-upload mr-2"></i>
          Upload Documents
        </span>
      </button>
    </div>
  </div>
</div>

<!-- Dialog Components -->
<app-dialog
  [visible]="dialogService.currentState.visible"
  [config]="dialogService.currentState.config"
  [loading]="dialogService.currentState.loading"
  (confirm)="dialogService.confirm(true)"
  (cancel)="dialogService.confirm(false)"
  (close)="dialogService.hideDialog()">
</app-dialog>


