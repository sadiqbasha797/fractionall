<div class="flex flex-col min-h-screen pb-20" style="background-color: #f5f5f5;">
  <div class="flex-grow">
      <div class="px-4 sm:px-6 lg:px-8 flex flex-1 justify-center py-2">
        <div class="layout-content-container flex flex-col w-[98%] max-w-[1800px] flex-1 mx-auto">
          <div class="@container">
            <div class="@[480px]:p-2">

            </div>
          </div>
          
          <!-- Main Search Bar (outside hero card, full width on mobile) -->
          <div class="px-4 py-4">
            <div class="w-full">
              <!-- Search Bar and Filter Button Row -->
              <div class="flex gap-3 items-center">
                <!-- Search Bar -->
                <div class="flex-1">
                  <label class="flex flex-col min-w-40 h-12 w-full @[480px]:h-14">
                    <div class="flex w-full flex-1 items-stretch rounded-lg h-full">
                      <input 
                        [ngModel]="searchQuery()"
                        (ngModelChange)="searchQuery.set($event)"
                        (keypress)="onSearchKeyPress($event)"
                        placeholder="Type in by Brand/Model/Seater/Fuel variants etc.,"
                        class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-black focus:outline-0 focus:ring-0 border border-black bg-white focus:border-black h-full placeholder:text-gray-500 px-[15px] rounded-l-lg rounded-r-none border-r-0 text-sm font-normal leading-normal @[480px]:text-base @[480px]:font-normal @[480px]:leading-normal" />
                      <div
                        class="flex items-center justify-center rounded-r-lg border-l-0 border border-black bg-white pr-[7px]">
                        <button
                            (click)="onSearchSubmit()"
                            class="flex w-12 h-12 @[480px]:h-14 cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-transparent text-black hover:bg-gray-100">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor"
                              viewBox="0 0 256 256">
                              <path
                                d="M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z">
                              </path>
                            </svg>
                          </button>
                      </div>
                    </div>
                  </label>
                </div>
                
                <!-- Location Button -->
                <button
                    (click)="openLocationModal()"
                    class="flex items-center justify-center w-12 h-12 @[480px]:h-14 bg-white border border-black rounded-lg hover:bg-gray-100 transition-colors"
                    title="Select Location">
                  <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                </button>
                
                <!-- Filter Button (Outside Search Bar) -->
                <button
                    (click)="toggleMobileFilterPopup()"
                    class="flex items-center justify-center w-12 h-12 @[480px]:h-14 bg-white border border-black rounded-lg hover:bg-gray-100 transition-colors">
                  <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.414A1 1 0 013 6.707V4z"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>
          
          <div class="flex flex-col gap-3 px-4 pb-3 pt-5">
            <!-- Location Filter Display -->
            <div *ngIf="selectedLocation()" class="flex items-center justify-between bg-blue-900/20 border border-blue-500/30 rounded-lg p-3">
              <div class="flex items-center gap-2">
                <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                <div class="text-blue-400 text-sm font-medium">
                  Showing cars in: {{ selectedLocation() }}{{ selectedState() ? ', ' + selectedState() : '' }}
                </div>
                <div class="text-gray-600 text-sm">
                  ({{ totalItems() }} {{ totalItems() === 1 ? 'car found' : 'cars found' }})
                </div>
              </div>
              <button 
                (click)="clearLocationFilter()"
                class="text-gray-600 hover:text-gray-800 text-sm font-medium underline">
                Clear Location Filter
              </button>
            </div>
            
            <h2 id="available-cars-heading" class="text-gray-800 text-lg sm:text-xl md:text-2xl lg:text-3xl xl:text-4xl font-bold leading-tight tracking-[-0.015em]">Available Cars</h2>
            
            <!-- Search Results Display -->
            <div *ngIf="(isSearchActive() && searchQuery()) || (isLocationSearchActive() && locationSearchQuery()) || (isBrandFilterActive() && brandFilter())" class="space-y-3">
              <!-- Brand Filter Results -->
              <div *ngIf="isBrandFilterActive() && brandFilter()" class="flex items-center justify-between bg-purple-900/20 border border-purple-500/30 rounded-lg p-3">
                <div class="flex items-center gap-2">
                  <div class="text-purple-400 text-sm font-medium">
                    Filtering by brand: "{{ brandFilter() }}"
                  </div>
                  <div class="text-gray-600 text-sm">
                    ({{ totalItems() }} {{ totalItems() === 1 ? 'car found' : 'cars found' }})
                  </div>
                </div>
                <button 
                  (click)="clearBrandFilter()"
                  class="text-gray-600 hover:text-gray-800 text-sm font-medium underline">
                  Clear Brand Filter
                </button>
              </div>
              
              <!-- Main Search Results -->
              <div *ngIf="isSearchActive() && searchQuery()" class="flex items-center justify-between bg-blue-900/20 border border-blue-500/30 rounded-lg p-3">
                <div class="flex items-center gap-2">
                  <div class="text-blue-400 text-sm font-medium">
                    Searching by car name/brand: "{{ searchQuery() }}"
                  </div>
                  <div class="text-gray-600 text-sm">
                    ({{ totalItems() }} {{ totalItems() === 1 ? 'car found' : 'cars found' }})
                  </div>
                </div>
                <button 
                  (click)="clearSearch()"
                  class="text-gray-600 hover:text-gray-800 text-sm font-medium underline">
                  Clear Search
                </button>
              </div>
              
              <!-- Location Search Results -->
              <div *ngIf="isLocationSearchActive() && locationSearchQuery() && !selectedLocation()" class="flex items-center justify-between bg-green-900/20 border border-green-500/30 rounded-lg p-3">
                <div class="flex items-center gap-2">
                  <div class="text-green-400 text-sm font-medium">
                    Searching by {{ locationSearchType() === 'pincode' ? 'pincode' : 'location' }}: "{{ locationSearchQuery() }}"
                  </div>
                  <div class="text-gray-600 text-sm">
                    ({{ totalItems() }} {{ totalItems() === 1 ? 'car found' : 'cars found' }})
                  </div>
                </div>
                <button 
                  (click)="clearLocationSearch()"
                  class="text-gray-600 hover:text-gray-800 text-sm font-medium underline">
                  Clear Location Search
                </button>
              </div>
              
              <!-- No Results Message -->
              <div *ngIf="totalItems() === 0" class="bg-red-900/20 border border-red-500/30 rounded-lg p-4 text-center">
                <div class="text-red-400 text-sm font-medium mb-2">No cars found</div>
                <div class="text-gray-600 text-sm">
                  No cars found matching your search criteria. 
                  Try different search terms or <button (click)="clearAllSearches()" class="text-blue-400 hover:text-blue-300 underline">clear all searches</button> to see all cars.
                </div>
              </div>
            </div>
          </div>

          <!-- Most Browsed Cars Section - COMMENTED OUT -->
          <!--
          <div class="px-4 pb-3">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-gray-800 text-[22px] font-bold leading-tight tracking-[-0.015em]">Most Browsed Cars</h2>
              <button 
                (click)="toggleMostBrowsedCars()"
                class="flex items-center gap-2 text-blue-400 hover:text-blue-300 text-sm font-medium transition-colors">
                <span>{{ showMostBrowsed() ? 'Hide' : 'Show' }} Most Browsed</span>
                <svg class="w-4 h-4 transition-transform" [class.rotate-180]="showMostBrowsed()" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </button>
            </div>

            <div *ngIf="showMostBrowsed()" class="space-y-4">
              <div *ngIf="isLoadingMostBrowsed()" class="flex items-center justify-center py-8">
                <div class="flex flex-col items-center gap-4">
                  <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                  <div class="text-gray-600 text-sm">Loading most browsed cars...</div>
                </div>
              </div>

              <div *ngIf="!isLoadingMostBrowsed() && mostBrowsedCars().length > 0" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <div *ngFor="let car of mostBrowsedCars(); let i = index" class="car-card flex flex-col items-stretch justify-between gap-4 rounded-lg p-4 relative overflow-hidden"
                  [attr.data-brand]="car.brandname || car.brand" [attr.data-mileage]="car.milege || car.mileage" [attr.data-color]="car.color" [attr.data-seating]="car.seating"
                  data-animation="fade-up" [attr.data-delay]="200 + (i * 100)">
                  
                  <div class="absolute top-0 left-0 w-32 h-32 z-20">
                    <div class="slanted-tag most-browsed">Most Browsed</div>
                  </div>

                  <div class="absolute top-2 right-2 z-20">
                    <div class="bg-orange-600 text-gray-800 text-xs rounded-full px-2 py-1 font-medium">
                      {{ car.viewCount || 0 }} views
                    </div>
                  </div>

                  <div class="flex flex-col gap-2">
                    <div class="w-full aspect-video rounded-lg flex-1 overflow-hidden bg-gray-800 flex items-center justify-center">
                      <img *ngIf="car.images && car.images.length" [src]="car.images[0]" [alt]="car.carname || car.brandname || 'car'" class="w-full h-full object-cover" />
                      <img *ngIf="!car.images || !car.images.length" src="/car.png" [alt]="car.carname || car.brandname || 'car'" class="w-full h-full object-cover" />
                    </div>
                    <div class="flex flex-col gap-2 mt-4">
                      <div class="flex items-start justify-between gap-2 w-full">
                        <div class="flex flex-col flex-1">
                          <div class="text-gray-800 font-bold text-lg">{{ car.carname || 'Unknown Model' }}</div>
                          <div class="text-gray-600 text-sm">{{ car.brandname || 'Unknown Brand' }}</div>
                          <div class="flex items-center gap-2 mt-1">
                            <div *ngIf="car.location" class="flex items-center gap-1 text-gray-500 text-xs">
                              <svg xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" fill="currentColor" viewBox="0 0 256 256" class="text-gray-500">
                                <path d="M128,64a40,40,0,1,0,40,40A40,40,0,0,0,128,64Zm0,64a24,24,0,1,1,24-24A24,24,0,0,1,128,128Zm0-112a88,88,0,0,0-88,88c0,31.4,14.51,64.68,42,96.25a254.19,254.19,0,0,0,41.45,38.3,8,8,0,0,0,9.18,0A254.19,254.19,0,0,0,220,136.25c27.45-31.57,42-64.85,42-96.25A88,88,0,0,0,128,16Zm0,206c-16.53-13-72-60.75-72-118a72,72,0,0,1,144,0C200,161.23,144.53,209,128,222Z"></path>
                              </svg>
                              <span>{{ car.location }}</span>
                            </div>
                            <div *ngIf="car.pincode" class="text-gray-500 text-xs">
                              {{ car.pincode }}
                            </div>
                          </div>
                          <div class="flex items-center gap-3 mt-2 text-xs text-gray-500">
                            <div *ngIf="car.seating" class="flex items-center gap-1">
                              <svg xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M120,80a8,8,0,0,1,8-8h0a8,8,0,0,1,8,8v8a8,8,0,0,1-8,8h0a8,8,0,0,1-8-8Zm-32,0a8,8,0,0,1,8-8h0a8,8,0,0,1,8,8v8a8,8,0,0,1-8,8h0a8,8,0,0,1-8-8Zm64,0a8,8,0,0,1,8-8h0a8,8,0,0,1,8,8v8a8,8,0,0,1-8,8h0a8,8,0,0,1-8-8ZM232,80v96a16,16,0,0,1-16,16H40a16,16,0,0,1-16-16V80a16,16,0,0,1,16-16H216A16,16,0,0,1,232,80ZM40,80v96H216V80H40Z"></path>
                              </svg>
                              <span>{{ car.seating }} seats</span>
                            </div>
                            <div *ngIf="car.fuel" class="flex items-center gap-1">
                              <svg xmlns="http://www.w3.org/2000/svg" width="12px" height="12px" fill="currentColor" viewBox="0 0 256 256">
                                <path d="M240,80v96a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V80a16,16,0,0,1,16-16H224A16,16,0,0,1,240,80ZM32,80v96H224V80H32Z"></path>
                              </svg>
                              <span>{{ car.fuel }}</span>
                            </div>
                            <div *ngIf="car.color" class="flex items-center gap-1">
                              <div class="w-3 h-3 rounded-full border border-gray-600" [style.background-color]="getColorCode(car.color)"></div>
                              <span>{{ car.color }}</span>
                            </div>
                          </div>
                        </div>
                        <div class="flex flex-col items-end gap-1">
                          <div *ngIf="car.ticketsavilble === 0" class="text-xs bg-red-600 text-gray-800 rounded-full px-2 py-0.5">Sold Out</div>
                          <div *ngIf="car.fractionprice" class="text-blue-600 font-semibold text-base">₹{{ car.fractionprice }}<span class="text-gray-600 text-sm font-normal">/per share</span></div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <button (click)="navigateToCarDetailsWithTracking(car._id || car.id)"
                    class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-8 px-4 flex-row-reverse btn-outline-white pr-2 gap-1 text-sm font-medium leading-normal w-fit">
                    <div class="text-gray-800" data-icon="ArrowRight" data-size="18px" data-weight="regular">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor" viewBox="0 0 256 256">
                        <path d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z"></path>
                      </svg>
                    </div>
                    <span class="truncate">Details</span>
                  </button>
                </div>
              </div>

              <div *ngIf="!isLoadingMostBrowsed() && mostBrowsedCars().length === 0" class="flex items-center justify-center py-8">
                <div class="text-center">
                  <div class="text-gray-400 text-lg mb-2">No most browsed cars available</div>
                  <div class="text-gray-500 text-sm">Cars will appear here as users browse them.</div>
                </div>
              </div>
            </div>
          </div>
          -->

          <!-- Desktop: full controls -->
          <div class="hidden md:flex flex-wrap gap-3 p-3 pr-4 mb-16 relative z-10" data-animation="fade-right" data-delay="100">
            <!-- Sort Dropdown -->
            <div class="relative" style="overflow:visible;">
              <button id="sort-dropdown" class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-lg btn-outline-white pl-4 pr-2 transition-colors">
                <p class="text-gray-800 text-sm font-medium leading-normal">Sort By</p>
                <div class="text-white" data-icon="CaretDown" data-size="20px" data-weight="regular">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256"><path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path></svg>
                </div>
              </button>
              <div id="sort-menu" class="absolute top-10 left-0 w-48 bg-[#1a2532] border border-[#344b65] rounded-lg shadow-lg z-40 hidden">
                <div class="py-2">
                  <a href="#" class="block px-4 py-2 text-sm text-gray-800 hover:bg-blue-600 transition-colors">A-Z (Sort by Car Name)</a>
                  <a href="#" class="block px-4 py-2 text-sm text-gray-800 hover:bg-blue-600 transition-colors">Newest Arrivals</a>
                  <a href="#" class="block px-4 py-2 text-sm text-gray-800 hover:bg-blue-600 transition-colors">Most Browsed</a>
                  <a href="#" class="block px-4 py-2 text-sm text-gray-800 hover:bg-blue-600 transition-colors">Top Selling</a>
                  <a href="#" class="block px-4 py-2 text-sm text-gray-800 hover:bg-blue-600 transition-colors">Share Price (Low-High)</a>
                  <a href="#" class="block px-4 py-2 text-sm text-gray-800 hover:bg-blue-600 transition-colors">Share Price (High-Low)</a>
                </div>
              </div>
            </div>
            <!-- Filter Dropdown -->
            <div class="relative" style="overflow:visible;">
              <button id="filter-dropdown" class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-lg btn-outline-white pl-4 pr-2 transition-colors">
                <p class="text-white text-sm font-medium leading-normal">Filter By</p>
                <div class="text-white" data-icon="CaretDown" data-size="20px" data-weight="regular">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256"><path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path></svg>
                </div>
              </button>
              <div id="filter-menu" class="absolute top-10 left-0 w-48 bg-[#1a2532] border border-[#344b65] rounded-lg shadow-lg z-40 hidden">
                <div class="py-2">
                  <a href="#" class="block px-4 py-2 text-sm text-white hover:bg-blue-600 transition-colors">All</a>
                  <a href="#" class="block px-4 py-2 text-sm text-white hover:bg-blue-600 transition-colors">Book Now</a>
                  <a href="#" class="block px-4 py-2 text-sm text-white hover:bg-blue-600 transition-colors">Join Waitlist</a>
                </div>
              </div>
            </div>
          </div>
          <!-- Loading State -->
          <div *ngIf="isLoading()" class="flex items-center justify-center py-12">
            <div class="flex flex-col items-center gap-4">
              <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
              <div class="text-gray-400 text-sm">Loading cars...</div>
            </div>
          </div>

          <!-- Fallback message for debugging -->
          <div *ngIf="!isLoading() && allCars().length === 0" class="flex items-center justify-center py-12">
            <div class="text-center">
              <div class="text-gray-400 text-lg mb-2">No cars data available</div>
              <div class="text-gray-500 text-sm">Please check the console for errors or try refreshing the page.</div>
            </div>
          </div>

          <!-- No Cars Message -->
          <div *ngIf="!isLoading() && cars().length === 0" class="flex items-center justify-center py-12">
            <div class="text-center">
              <div class="text-gray-400 text-lg mb-2">No cars available</div>
              <div class="text-gray-500 text-sm">
                <span *ngIf="currentFilter() !== 'All'">No cars found for "{{ currentFilter() }}" filter. </span>
                <span *ngIf="isBrandFilterActive() && brandFilter()">No cars found for "{{ brandFilter() }}" brand. </span>
                <span *ngIf="isSearchActive() && searchQuery()">No cars found for "{{ searchQuery() }}" search. </span>
                <span *ngIf="isLocationSearchActive() && locationSearchQuery()">No cars found for "{{ locationSearchQuery() }}" location. </span>
                <span *ngIf="currentFilter() === 'All' && !isSearchActive() && !isLocationSearchActive() && !isBrandFilterActive()">Please check back later or try adjusting your filters.</span>
                <button *ngIf="currentFilter() !== 'All' || isSearchActive() || isLocationSearchActive() || isBrandFilterActive()" 
                        (click)="clearAllFilters()" 
                        class="text-blue-400 hover:text-blue-300 underline ml-1">
                  Clear filters
                </button>
              </div>
            </div>
          </div>

          <!-- Cars Grid -->
          <div *ngIf="!isLoading() && cars().length > 0" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 relative z-0 mb-4" id="car-grid">
            <div *ngFor="let car of cars(); let i = index" 
                 (click)="navigateToCarDetailsWithTracking(car._id || car.id)"
                 class="car-card flex flex-col items-stretch justify-between gap-4 rounded-2xl p-4 relative overflow-hidden transform hover:scale-[1.02] transition-all duration-300 cursor-pointer"
              [attr.data-brand]="car.brandname || car.brand" [attr.data-mileage]="car.milege || car.mileage" [attr.data-color]="car.color" [attr.data-seating]="car.seating"
              data-animation="fade-up" [attr.data-delay]="200 + (i * 200)">
              
              <!-- Slanted Tag -->
              <div class="absolute top-0 right-0 w-32 h-32 z-20">
                <div *ngIf="car.tokensavailble === 0; else waitlist" class="slanted-tag book-now">Book Now</div>
                <ng-template #waitlist>
                  <div class="slanted-tag join-waitlist">Join Waitlist</div>
                </ng-template>
              </div>

              <div class="flex flex-col gap-2">
                <div class="w-full aspect-video rounded-xl flex-1 overflow-hidden bg-gray-800 flex items-center justify-center relative">
                  <img *ngIf="car.images && car.images.length" [src]="car.images[0]" [alt]="car.carname || car.brandname || 'car'"
                    class="w-full h-full object-cover" />
                  <img *ngIf="!car.images || !car.images.length" src="/car.png" [alt]="car.carname || car.brandname || 'car'"
                    class="w-full h-full object-cover" />
                  
                  <!-- Overlay with car information -->
                  <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 via-black/50 to-transparent p-4">
                    <div class="flex flex-col gap-1">
                      <div class="text-white font-bold text-lg sm:text-xl">{{ car.carname || 'Unknown Model' }}</div>
                      <div class="text-gray-300 text-sm sm:text-base">{{ car.brandname || 'Unknown Brand' }}</div>
                      <div *ngIf="car.fractionprice" class="flex items-center gap-2 mt-1">
                        <div class="text-blue-400 font-semibold text-base sm:text-lg">₹{{ formatPrice(car.fractionprice) }}<span class="text-gray-300 text-sm font-normal">/per share</span></div>
                        <button 
                          (click)="showPricingInfo($event)"
                          class="w-4 h-4 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-colors group relative"
                          title="Pricing Information">
                          <svg class="w-2.5 h-2.5 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
                          </svg>
                          <!-- Tooltip -->
                          <div class="absolute bottom-full right-0 mb-2 w-64 p-3 bg-gray-800 border border-gray-600 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                            <div class="text-xs text-gray-300 leading-relaxed">
                              The above prices are subject to change, the final prices will be based on dealers final proforma invoice at the time of purchase
                            </div>
                            <!-- Arrow -->
                            <div class="absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-800"></div>
                          </div>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Mobile: Pagination -->
          <div *ngIf="!isLoading() && totalPages() > 1 && isMobile()" class="flex items-center justify-center p-4 pagination-wrap mobile-pagination" data-animation="fade-up" data-delay="1400">
            <!-- Previous button -->
            <button 
              (click)="goToPreviousPage()" 
              [disabled]="currentPage() === 1"
              [class.opacity-50]="currentPage() === 1"
              [class.cursor-not-allowed]="currentPage() === 1"
              class="flex size-12 items-center justify-center bg-gray-800 hover:bg-gray-700 rounded-lg mx-1 transition-colors">
              <div class="text-white" data-icon="CaretLeft" data-size="20px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor"
                  viewBox="0 0 256 256">
                  <path
                    d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z">
                  </path>
                </svg>
              </div>
            </button>

            <!-- Page numbers - show fewer on mobile -->
            <button 
              *ngFor="let page of getMobilePageNumbers()" 
              (click)="goToPage(page)"
              [ngClass]="{
                'text-sm font-bold leading-normal tracking-[0.015em] flex size-12 items-center justify-center text-white rounded-lg bg-blue-600 mx-1': page === currentPage(),
                'text-sm font-normal leading-normal flex size-12 items-center justify-center text-white rounded-lg bg-gray-800 hover:bg-gray-700 mx-1 transition-colors': page !== currentPage()
              }">
              {{ page }}
            </button>

            <!-- Next button -->
            <button 
              (click)="goToNextPage()" 
              [disabled]="currentPage() === totalPages()"
              [class.opacity-50]="currentPage() === totalPages()"
              [class.cursor-not-allowed]="currentPage() === totalPages()"
              class="flex size-12 items-center justify-center bg-gray-800 hover:bg-gray-700 rounded-lg mx-1 transition-colors">
              <div class="text-white" data-icon="CaretRight" data-size="20px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor"
                  viewBox="0 0 256 256">
                  <path
                    d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z">
                  </path>
                </svg>
              </div>
            </button>

            <!-- Tiny pagination loader shown when a page nav button is clicked (non-navigation) -->
            <div id="pagination-loader-mobile" class="tiny-loader" aria-hidden="true" title="Loading">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </div>
          </div>
          
          <!-- Desktop: Pagination -->
          <div *ngIf="!isLoading() && totalPages() > 1 && !isMobile()" id="pagination" class="flex items-center justify-center p-4 pagination-wrap" data-animation="fade-up" data-delay="1400">
            <!-- Previous button -->
            <button 
              (click)="goToPreviousPage()" 
              [disabled]="currentPage() === 1"
              [class.opacity-50]="currentPage() === 1"
              [class.cursor-not-allowed]="currentPage() === 1"
              class="flex size-10 items-center justify-center">
              <div class="text-white" data-icon="CaretLeft" data-size="18px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor"
                  viewBox="0 0 256 256">
                  <path
                    d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z">
                  </path>
                </svg>
              </div>
            </button>

            <!-- Page numbers -->
            <button 
              *ngFor="let page of getPageNumbers()" 
              (click)="goToPage(page)"
              [ngClass]="{
                'text-sm font-bold leading-normal tracking-[0.015em] flex size-10 items-center justify-center text-white rounded-full bg-blue-600': page === currentPage(),
                'text-sm font-normal leading-normal flex size-10 items-center justify-center text-white rounded-full': page !== currentPage()
              }">
              {{ page }}
            </button>

            <!-- Next button -->
            <button 
              (click)="goToNextPage()" 
              [disabled]="currentPage() === totalPages()"
              [class.opacity-50]="currentPage() === totalPages()"
              [class.cursor-not-allowed]="currentPage() === totalPages()"
              class="flex size-10 items-center justify-center">
              <div class="text-white" data-icon="CaretRight" data-size="18px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" fill="currentColor"
                  viewBox="0 0 256 256">
                  <path
                    d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z">
                  </path>
                </svg>
              </div>
            </button>

            <!-- Tiny pagination loader shown when a page nav button is clicked (non-navigation) -->
            <div id="pagination-loader" class="tiny-loader" aria-hidden="true" title="Loading">
              <span class="dot"></span>
              <span class="dot"></span>
              <span class="dot"></span>
            </div>
          </div>


        </div>
      </div>
    </div>

    <!-- Mobile Filter/Sort Popup - positioned above bottom navbar -->
    <div *ngIf="isBrowser() && (isMobileSortPopupOpen() || isMobileFilterPopupOpen())" 
         class="fixed inset-0 lg:hidden z-40"
         (click)="closeMobilePopups()">
      <!-- Backdrop -->
      <div class="absolute inset-0 bg-black/50"></div>
      
      <!-- Popup positioned above bottom navbar -->
      <div class="absolute bottom-20 left-4 right-4 bg-white border border-black rounded-xl shadow-xl max-h-96 overflow-hidden"
           (click)="$event.stopPropagation()">
        <!-- Mobile Filter Popup -->
        <div *ngIf="isMobileFilterPopupOpen()" class="fixed inset-0 z-50 flex items-end md:items-center justify-center p-4" (click)="closeMobilePopups()">
          <div class="absolute inset-0 bg-gray-500/30 backdrop-blur-sm" (click)="closeMobilePopups()"></div>
          <div class="relative bg-white border border-black rounded-t-2xl md:rounded-2xl shadow-xl w-full max-w-md max-h-[80vh] overflow-hidden" (click)="$event.stopPropagation()">
            
            <!-- Header -->
            <div class="flex items-center justify-between p-4 border-b border-black">
              <h3 class="text-black font-semibold text-lg">Filter & Sort</h3>
              <button (click)="closeMobilePopups()" class="text-gray-600 hover:text-black transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
            
            <!-- Content -->
            <div class="p-4 space-y-6 max-h-96 overflow-y-auto">
              
              <!-- Sort Section -->
              <div>
                <h4 class="text-black font-medium text-base mb-3">Sort</h4>
                <div class="space-y-2">
                  <button 
                    *ngFor="let option of sortOptions"
                    (click)="onSortChange(option)"
                    class="w-full text-left px-4 py-3 rounded-lg border border-black transition-colors"
                    [class]="option === currentSort() ? 'bg-gray-200 text-black border-black' : 'text-gray-700 hover:bg-gray-100 border-gray-300'">
                    {{ option }}
                  </button>
                </div>
              </div>
              
              <!-- Filter Section -->
              <div>
                <h4 class="text-black font-medium text-base mb-3">Filter</h4>
                <div class="space-y-2">
                  <button 
                    *ngFor="let option of filterOptions"
                    (click)="onFilterChange(option)"
                    class="w-full text-left px-4 py-3 rounded-lg border transition-colors"
                    [class]="option === currentFilter() ? 'bg-blue-100 text-blue-800 border-blue-400' : 'text-gray-700 hover:bg-blue-50 border-gray-300'">
                    {{ option }}
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Bottom Actions -->
            <div class="flex items-center gap-3 p-4 border-t border-black">
              <button 
                (click)="clearAllFilters()"
                class="flex-1 px-4 py-3 rounded-lg border border-black text-black hover:bg-gray-100 transition-colors">
                Clear
              </button>
              <button 
                (click)="applyFilters()"
                class="flex-1 px-4 py-3 rounded-lg bg-black text-white hover:bg-gray-800 transition-colors">
                Apply
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Location Selection Modal -->
    <div *ngIf="isLocationModalOpen()" class="fixed inset-0 z-50 flex items-center justify-center p-4" (click)="closeLocationModal()">
      <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" (click)="closeLocationModal()"></div>
      <div class="relative bg-[#1a2532] border border-[#344b65] rounded-lg shadow-xl w-full max-w-md max-h-[80vh] overflow-hidden" (click)="$event.stopPropagation()">
        <!-- Header -->
        <div class="flex items-center justify-between p-4 border-b border-[#344b65]">
          <h3 class="text-white font-semibold text-lg">Select Your Location</h3>
          <button (click)="closeLocationModal()" class="text-gray-400 hover:text-white transition-colors">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        
        <!-- Search Input -->
        <div class="p-4 border-b border-[#344b65]">
          <input 
            [ngModel]="locationModalQuery()"
            (ngModelChange)="onLocationModalInputChange($event)"
            (keypress)="onLocationModalSearchKeyPress($event)"
            placeholder="Type to search or select city..."
            class="w-full px-3 py-2 text-white bg-[#101a23] border border-[#344b65] rounded focus:outline-none focus:border-blue-500 text-sm"
          />
        </div>
        
        <!-- Location Suggestions -->
        <div class="max-h-60 overflow-y-auto">
          <!-- Loading State -->
          <div *ngIf="isLocationModalLoading()" class="flex items-center justify-center py-8">
            <div class="flex flex-col items-center gap-2">
              <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"></div>
              <div class="text-gray-400 text-sm">Searching locations...</div>
            </div>
          </div>
          
          <!-- Show suggestions when no search query or when there are results -->
          <div *ngIf="!isLocationModalLoading() && (allLocationModalSuggestions().length > 0 || !locationModalQuery())">
            <!-- Popular Cities Header -->
            <div *ngIf="!locationModalQuery()" class="px-4 py-2 text-gray-400 text-xs font-medium border-b border-[#344b65]">
              Popular Cities
            </div>
            
            <!-- Suggestions -->
            <button
              *ngFor="let suggestion of allLocationModalSuggestions()"
              (click)="selectLocationFromModal(suggestion)"
              class="w-full text-left px-4 py-3 text-[#93acc8] hover:bg-[#344b65] hover:text-white transition-colors text-sm border-b border-[#344b65]/30 last:border-b-0">
              <div class="flex flex-col">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span class="font-semibold">{{ suggestion.name }}</span>
                  </div>
                </div>
                <span *ngIf="suggestion.state" class="text-xs text-gray-400 mt-1 ml-6">{{ suggestion.state }}</span>
              </div>
            </button>
          </div>
          
          <!-- No Results -->
          <div *ngIf="!isLocationModalLoading() && locationModalQuery() && allLocationModalSuggestions().length === 0" class="flex items-center justify-center py-8">
            <div class="text-center">
              <div class="text-gray-400 text-sm mb-2">No locations found</div>
              <div class="text-gray-500 text-xs">Try a different search term</div>
            </div>
          </div>
        </div>
      </div>
    </div>

</div>