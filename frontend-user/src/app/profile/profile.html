<div class="profile-container">
  <!-- Header Section -->
  <div class="profile-header">
    <h1 class="profile-title">My Profile</h1>
    <button class="edit-profile-btn" (click)="openEditModal()">
      <svg class="edit-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z">
        </path>
      </svg>
      <span>Edit Profile</span>
    </button>
  </div>

  <!-- Error Message -->
  <div *ngIf="error()" class="error-message" style="color: #ef4444; text-align: center; margin-bottom: 1rem; padding: 1rem; background-color: rgba(239, 68, 68, 0.1); border-radius: 0.5rem;">
    {{ error() }}
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading()" class="loading-spinner" style="text-align: center; padding: 2rem;">
    <div style="display: inline-block; width: 2rem; height: 2rem; border: 3px solid #4a5568; border-radius: 50%; border-top-color: #3b82f6; animation: spin 1s ease-in-out infinite;"></div>
    <p style="margin-top: 1rem; color: #9ca3af;">Loading profile...</p>
  </div>

  <!-- Main Content Grid -->
  <div class="profile-grid" *ngIf="!loading()">
    <!-- Left Column - User Info and Tickets/Tokens -->
    <div class="left-column">
      <!-- User Profile Card -->
      <div class="profile-card">
        <!-- Profile Header with Avatar and Basic Info -->
        <div class="profile-header-section">
          <div class="profile-avatar-section">
            <div class="profile-avatar">
              <img [src]="user().profileimage || 'public/person_1.jpg'" [alt]="user().name || 'Profile Image'" />
              <!-- Upload progress overlay -->
              <div *ngIf="uploadingImage()" class="upload-overlay">
                <div class="upload-spinner"></div>
              </div>
            </div>
            <button class="change-photo-btn" (click)="triggerFileInput()" [disabled]="uploadingImage()">
              <span *ngIf="uploadingImage()">Uploading...</span>
              <span *ngIf="!uploadingImage()">Change Photo</span>
            </button>
            <!-- Success message -->
            <div *ngIf="imageUploadSuccess()" class="upload-success" style="margin-top: 0.5rem; font-size: 0.75rem; color: #10b981; text-align: center;">
              {{ imageUploadSuccess() }}
            </div>
            <!-- Error message -->
            <div *ngIf="imageUploadError()" class="upload-error" style="margin-top: 0.5rem; font-size: 0.75rem; color: #ef4444; text-align: center;">
              {{ imageUploadError() }}
            </div>
          </div>
          
          <div class="profile-basic-info">
            <h2 class="profile-name">{{ user().name || 'Not provided' }}</h2>
            <p class="profile-email">{{ user().email || 'Not provided' }}</p>
            <div class="profile-status-badges">
              <span class="status-badge" [class.verified]="user().verified" [class.unverified]="!user().verified">
                {{ getVerificationStatus() }}
              </span>
              <span class="status-badge kyc-status" [class]="getKycStatusClass()">
                {{ getKycStatusDisplay() }}
              </span>
            </div>
          </div>
          
          <!-- Expand/Collapse Toggle Button -->
          <button class="expand-toggle-btn" (click)="toggleProfileExpansion()" [class.expanded]="isProfileExpanded()">
            <svg class="expand-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
            <span class="expand-text">{{ isProfileExpanded() ? 'Show Less' : 'Show More' }}</span>
          </button>
        </div>

        <!-- Expandable Profile Details -->
        <div class="profile-details-expandable" [class.expanded]="isProfileExpanded()">
          <div class="profile-details-content">
            <!-- Personal Information Section -->
            <div class="info-section">
              <h3 class="section-title">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                Personal Information
              </h3>
              <div class="info-grid">
                <div class="info-item">
                  <label class="info-label">Mobile Number</label>
                  <p class="info-value">{{ user().phone || 'Not provided' }}</p>
                </div>
                <div class="info-item">
                  <label class="info-label">Date of Birth</label>
                  <p class="info-value">{{ formatDate(user().dateofbirth) }}</p>
                </div>
                <div class="info-item">
                  <label class="info-label">Member Since</label>
                  <p class="info-value">{{ formatDate(user().createdAt) }}</p>
                </div>
              </div>
            </div>

            <!-- Location Information Section -->
            <div class="info-section">
              <h3 class="section-title">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                Location Information
              </h3>
              <div class="info-grid">
                <div class="info-item">
                  <label class="info-label">Location</label>
                  <p class="info-value">{{ user().location || 'Not provided' }}</p>
                </div>
                <div class="info-item">
                  <label class="info-label">Pincode</label>
                  <p class="info-value">{{ user().pincode || 'Not provided' }}</p>
                </div>
              </div>
              <div class="info-item full-width">
                <label class="info-label">Address</label>
                <p class="info-value">{{ user().address || 'Not provided' }}</p>
              </div>
            </div>
            
            <!-- Government ID Section -->
            <div class="info-section">
              <h3 class="section-title">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"></path>
                </svg>
                Government IDs
              </h3>
              <div class="info-grid">
                <div class="info-item">
                  <label class="info-label">Aadhar ID</label>
                  <p class="info-value">{{ formatGovernmentId('aadharid', user().governmentid?.aadharid) }}</p>
                </div>
                <div class="info-item">
                  <label class="info-label">PAN ID</label>
                  <p class="info-value">{{ formatGovernmentId('panid', user().governmentid?.panid) }}</p>
                </div>
                <div class="info-item">
                  <label class="info-label">License ID</label>
                  <p class="info-value">{{ formatGovernmentId('licenseid', user().governmentid?.licenseid) }}</p>
                </div>
                <div class="info-item">
                  <label class="info-label">Income</label>
                  <p class="info-value">{{ user().governmentid?.income || 'Not provided' }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile KYC Card -->
      <div class="kyc-card mobile-kyc">
        <div class="kyc-header">
          <h2 class="kyc-title">KYC Status</h2>
          <div class="kyc-status" [class]="getKycStatusClass()">
            <svg class="status-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
              <path d="M12 9v4"></path>
              <path d="M12 17h.01"></path>
            </svg>
            <span>{{ getKycStatusDisplay() }}</span>
          </div>
        </div>
        <p class="kyc-description">Please submit the required documents to get your account verified and access all features.</p>
        <button class="submit-docs-btn" (click)="openDocModal()" *ngIf="user().kycStatus === 'pending' || user().kycStatus === 'rejected'">
          <span *ngIf="user().kycStatus === 'pending'">Submit Documents</span>
          <span *ngIf="user().kycStatus === 'rejected'">Resubmit Documents</span>
        </button>
        
        <!-- Show rejection reason if KYC is rejected -->
        <div *ngIf="user().kycStatus === 'rejected'" class="kyc-rejection-info">
          <div class="rejection-notice">
            <svg class="warning-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
            <div class="rejection-content">
              <span class="rejection-title">Your KYC documents were rejected.</span>
              <!-- Show rejection comments if available -->
              <div *ngIf="getRejectionComments().length > 0" class="rejection-comments">
                <div *ngFor="let comment of getRejectionComments()" class="rejection-comment">
                  <p class="comment-text">{{ comment.comment }}</p>
                  <span class="comment-date">{{ formatDate(comment.date) }}</span>
                </div>
              </div>
              <p class="rejection-action">Please upload new documents to resubmit your KYC.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- My Shares Section -->
      <div class="tickets-card">
        <h2 class="section-title">My Shares</h2>
        
        <!-- Loading state -->
        <div *ngIf="ticketsLoading()" class="loading-spinner" style="text-align: center; padding: 1rem;">
          <div style="display: inline-block; width: 1.5rem; height: 1.5rem; border: 2px solid #4a5568; border-radius: 50%; border-top-color: #3b82f6; animation: spin 1s ease-in-out infinite;"></div>
          <p style="margin-top: 0.5rem; color: #9ca3af; font-size: 0.875rem;">Loading shares...</p>
        </div>

        <!-- Error state -->
        <div *ngIf="ticketsError() && !ticketsLoading()" class="error-message" style="color: #ef4444; text-align: center; margin: 1rem 0; padding: 1rem; background-color: rgba(239, 68, 68, 0.1); border-radius: 0.5rem;">
          {{ ticketsError() }}
        </div>

        <!-- Contract Documents Loading state -->
        <div *ngIf="contractDocumentsLoading()" class="loading-spinner" style="text-align: center; padding: 1rem;">
          <div style="display: inline-block; width: 1.5rem; height: 1.5rem; border: 2px solid #4a5568; border-radius: 50%; border-top-color: #3b82f6; animation: spin 1s ease-in-out infinite;"></div>
          <p style="margin-top: 0.5rem; color: #9ca3af; font-size: 0.875rem;">Loading contract documents...</p>
        </div>

        <!-- Contract Documents Error state -->
        <div *ngIf="contractDocumentsError() && !contractDocumentsLoading()" class="error-message" style="color: #ef4444; text-align: center; margin: 1rem 0; padding: 1rem; background-color: rgba(239, 68, 68, 0.1); border-radius: 0.5rem;">
          {{ contractDocumentsError() }}
        </div>



        <!-- No shares state -->
        <div *ngIf="!ticketsLoading() && !ticketsError() && tickets().length === 0" class="no-tickets" style="text-align: center; padding: 2rem; color: #9ca3af;">
          <p>No shares found. You haven't purchased any shares yet.</p>
        </div>

        <!-- Shares grid -->
        <div class="tickets-grid" *ngIf="!ticketsLoading() && !ticketsError() && tickets().length > 0">
          <div *ngFor="let ticket of tickets()" class="ticket-item" [class.expired]="ticket.ticketstatus === 'expired'">
            <!-- Car Image -->
            <div class="ticket-car-image" *ngIf="ticket.carid">
              <img [src]="ticket.carid.images && ticket.carid.images.length > 0 ? ticket.carid.images[0] : 'public/car.png'" [alt]="ticket.carid.carname" />
            </div>
            <div class="ticket-header">
              <span class="ticket-type">SHARE #{{ ticket.ticketcustomid }}</span>
              <span class="ticket-status" [class.active]="ticket.ticketstatus === 'active'" [class.expired]="ticket.ticketstatus === 'expired'">
                {{ ticket.ticketstatus | titlecase }}
              </span>
            </div>
            <p class="ticket-id">Share ID: {{ ticket._id }}</p>
            <p class="ticket-model" *ngIf="ticket.carid">{{ ticket.carid.carname }}</p>
            <p class="ticket-brand" *ngIf="ticket.carid">{{ ticket.carid.brandname }} - {{ ticket.carid.color }}</p>
            <div class="ticket-dates">
              <div class="date-item">Expires: <span>{{ formatDate(ticket.ticketexpiry) }}</span></div>
              <div class="date-item">Purchased: <span>{{ formatDate(ticket.ticketbroughtdate) }}</span></div>
            </div>
            <div class="ticket-pricing">
              <div class="price-item">Total Price: <span>₹{{ formatPrice(ticket.ticketprice) }}</span></div>
              <div class="price-item">Paid: <span>₹{{ formatPrice(ticket.pricepaid) }}</span></div>
              <div class="price-item" *ngIf="ticket.pendingamount > 0">Pending: <span>₹{{ formatPrice(ticket.pendingamount) }}</span></div>
            </div>
            <div class="ticket-comments" *ngIf="ticket.comments">
              <p><strong>Comments:</strong> {{ ticket.comments }}</p>
            </div>
            
            <!-- Contract Documents Section -->
            <div class="contract-documents-section" *ngIf="ticket._id && getContractDocumentsForTicket(ticket._id).length > 0">
              <h4 class="contract-documents-title">Contract Documents</h4>
              <div class="contract-documents-list">
                <div *ngFor="let contract of getContractDocumentsForTicket(ticket._id || '')" class="contract-item">
                  <div *ngFor="let doc of contract.contract_docs; let i = index" class="document-item">
                    <div class="document-info">
                      <svg class="document-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                      </svg>
                      <span class="document-name">Contract Document {{ i + 1 }}</span>
                    </div>
                    <button class="download-btn" (click)="downloadContractDocument(contract._id, i, contract.ticketid.ticketcustomid, contract.carid.carname)" *ngIf="contract._id && contract.ticketid.ticketcustomid && contract.carid.carname">
                      <svg class="download-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                      </svg>
                      Download
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Shared Members Section -->
            <div class="shared-members-section" *ngIf="ticket._id">
              <div class="shared-members-header">
                <h4 class="shared-members-title">Shared Members</h4>
                <button class="add-shared-member-btn" (click)="openSharedMemberModal(ticket._id)" [disabled]="getSharedMembersForTicket(ticket._id).length >= 3">
                  <svg class="add-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                  </svg>
                  <span *ngIf="getSharedMembersForTicket(ticket._id).length < 3">Add Member</span>
                  <span *ngIf="getSharedMembersForTicket(ticket._id).length >= 3">Limit Reached</span>
                </button>
              </div>
              
              <!-- Shared Members Loading -->
              <div *ngIf="sharedMembersLoading()" class="loading-spinner" style="text-align: center; padding: 1rem;">
                <div style="display: inline-block; width: 1rem; height: 1rem; border: 2px solid #4a5568; border-radius: 50%; border-top-color: #3b82f6; animation: spin 1s ease-in-out infinite;"></div>
                <p style="margin-top: 0.5rem; color: #9ca3af; font-size: 0.75rem;">Loading shared members...</p>
              </div>

              <!-- Shared Members Error -->
              <div *ngIf="sharedMembersError() && !sharedMembersLoading()" class="error-message" style="color: #ef4444; text-align: center; margin: 0.5rem 0; padding: 0.5rem; background-color: rgba(239, 68, 68, 0.1); border-radius: 0.25rem; font-size: 0.75rem;">
                {{ sharedMembersError() }}
              </div>

              <!-- No shared members -->
              <div *ngIf="!sharedMembersLoading() && !sharedMembersError() && getSharedMembersForTicket(ticket._id).length === 0" class="no-shared-members" style="text-align: center; padding: 1rem; color: #9ca3af; font-size: 0.75rem;">
                <p>No shared members yet. You can share this ticket with up to 3 members.</p>
              </div>

              <!-- Shared Members List -->
              <div class="shared-members-list" *ngIf="!sharedMembersLoading() && !sharedMembersError() && getSharedMembersForTicket(ticket._id).length > 0">
                <div *ngFor="let member of getSharedMembersForTicket(ticket._id)" class="shared-member-item">
                  <div class="shared-member-info">
                    <div class="member-avatar">
                      <svg class="member-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                      </svg>
                    </div>
                    <div class="member-details">
                      <div class="member-name">{{ member.name }}</div>
                      <div class="member-email">{{ member.email }}</div>
                      <div class="member-mobile">{{ member.mobileNumber }}</div>
                    </div>
                    <div class="member-status">
                      <span class="status-badge" [class]="getSharedMemberStatusClass(member.status)">
                        {{ getSharedMemberStatusDisplay(member.status) }}
                      </span>
                    </div>
                  </div>
                  <div class="member-actions">
                    <button class="delete-member-btn" (click)="deleteSharedMember(member._id)" title="Delete Member">
                      <svg class="delete-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Member Limit Notice -->
              <div *ngIf="getSharedMembersForTicket(ticket._id).length >= 3" class="member-limit-notice" style="text-align: center; padding: 0.5rem; color: #f59e0b; font-size: 0.75rem; background-color: rgba(245, 158, 11, 0.1); border-radius: 0.25rem; margin-top: 0.5rem;">
                <svg class="warning-icon" fill="currentColor" viewBox="0 0 20 20" style="width: 1rem; height: 1rem; margin-right: 0.25rem; display: inline-block;">
                  <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                Maximum of 3 shared members reached for this ticket.
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- My Waitlist Section -->
      <div class="tokens-card">
        <h2 class="section-title">My Waitlist</h2>
        
        <!-- Loading state -->
        <div *ngIf="tokensLoading()" class="loading-spinner" style="text-align: center; padding: 1rem;">
          <div style="display: inline-block; width: 1.5rem; height: 1.5rem; border: 2px solid #4a5568; border-radius: 50%; border-top-color: #3b82f6; animation: spin 1s ease-in-out infinite;"></div>
          <p style="margin-top: 0.5rem; color: #9ca3af; font-size: 0.875rem;">Loading waitlist...</p>
        </div>

        <!-- Error state -->
        <div *ngIf="tokensError() && !tokensLoading()" class="error-message" style="color: #ef4444; text-align: center; margin: 1rem 0; padding: 1rem; background-color: rgba(239, 68, 68, 0.1); border-radius: 0.5rem;">
          {{ tokensError() }}
        </div>

        <!-- No waitlist state -->
        <div *ngIf="!tokensLoading() && !tokensError() && tokens().length === 0" class="no-tokens" style="text-align: center; padding: 2rem; color: #9ca3af;">
          <p>No waitlist items found. You haven't joined any waitlist yet.</p>
        </div>

        <!-- Waitlist grid -->
        <div class="tokens-grid" *ngIf="!tokensLoading() && !tokensError() && tokens().length > 0">
          <div *ngFor="let token of tokens()" class="token-item" [class.expired]="token.status === 'expired'">
            <!-- Car Image -->
            <div class="token-car-image" *ngIf="token.carid">
              <img [src]="token.carid.images && token.carid.images.length > 0 ? token.carid.images[0] : 'public/car.png'" [alt]="token.carid.carname" />
            </div>
            <div class="ticket-header">
              <span class="ticket-type">WAITLIST #{{ token.customtokenid }}</span>
              <span class="ticket-status" [class.active]="token.status === 'active'" [class.expired]="token.status === 'expired'" [class.refund-requested]="token.status === 'refund_requested'" [class.refund-initiated]="token.status === 'refund_initiated'" [class.refund-processed]="token.status === 'refund_processed'">
                {{ token.status | titlecase }}
              </span>
            </div>
            <p class="ticket-id">Waitlist ID: {{ token._id }}</p>
            <p class="ticket-model" *ngIf="token.carid">{{ token.carid.carname }}</p>
            <p class="ticket-brand" *ngIf="token.carid">{{ token.carid.brandname }} - {{ token.carid.color }}</p>
            <div class="ticket-dates">
              <div class="date-item">Expires: <span>{{ formatDate(token.expirydate) }}</span></div>
              <div class="date-item">Purchased: <span>{{ formatDate(token.date) }}</span></div>
            </div>
            <div class="ticket-pricing">
              <div class="price-item">Amount Paid: <span>₹{{ formatPrice(token.amountpaid) }}</span></div>
            </div>
            <div class="ticket-actions" *ngIf="token.status === 'active'">
              <button (click)="cancelToken(token)" class="cancel-btn">
                <i class="fas fa-times"></i>
                Cancel Token
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- My Book Now Tokens Section -->
      <div class="booknow-tokens-card">
        <h2 class="section-title">My Book Now Tokens</h2>
        
        <!-- Loading state -->
        <div *ngIf="bookNowTokensLoading()" class="loading-spinner" style="text-align: center; padding: 1rem;">
          <div style="display: inline-block; width: 1.5rem; height: 1.5rem; border: 2px solid #4a5568; border-radius: 50%; border-top-color: #3b82f6; animation: spin 1s ease-in-out infinite;"></div>
          <p style="margin-top: 0.5rem; color: #9ca3af; font-size: 0.875rem;">Loading book now tokens...</p>
        </div>

        <!-- Error state -->
        <div *ngIf="bookNowTokensError() && !bookNowTokensLoading()" class="error-message" style="color: #ef4444; text-align: center; margin: 1rem 0; padding: 1rem; background-color: rgba(239, 68, 68, 0.1); border-radius: 0.5rem;">
          {{ bookNowTokensError() }}
        </div>

        <!-- No book now tokens state -->
        <div *ngIf="!bookNowTokensLoading() && !bookNowTokensError() && bookNowTokens().length === 0" class="no-booknow-tokens" style="text-align: center; padding: 2rem; color: #9ca3af;">
          <p>No book now tokens found. You haven't purchased any book now tokens yet.</p>
        </div>

        <!-- Book now tokens grid -->
        <div class="booknow-tokens-grid" *ngIf="!bookNowTokensLoading() && !bookNowTokensError() && bookNowTokens().length > 0">
          <div *ngFor="let bookNowToken of bookNowTokens()" class="booknow-token-item" [class.expired]="bookNowToken.status === 'expired'">
            <!-- Car Image -->
            <div class="booknow-token-car-image" *ngIf="bookNowToken.carid">
              <img [src]="bookNowToken.carid.images && bookNowToken.carid.images.length > 0 ? bookNowToken.carid.images[0] : '/car.png'" [alt]="bookNowToken.carid.carname" />
            </div>
            <div class="ticket-header">
              <span class="ticket-type">BOOK NOW TOKEN #{{ bookNowToken.customtokenid }}</span>
              <span class="ticket-status" [class.active]="bookNowToken.status === 'active'" [class.expired]="bookNowToken.status === 'expired'" [class.dropped]="bookNowToken.status === 'dropped'" [class.refund-requested]="bookNowToken.status === 'refund_requested'" [class.refund-initiated]="bookNowToken.status === 'refund_initiated'" [class.refund-processed]="bookNowToken.status === 'refund_processed'">
                {{ bookNowToken.status | titlecase }}
              </span>
            </div>
            <p class="ticket-id">Token ID: {{ bookNowToken._id }}</p>
            <p class="ticket-model" *ngIf="bookNowToken.carid">{{ bookNowToken.carid.carname }}</p>
            <p class="ticket-brand" *ngIf="bookNowToken.carid">{{ bookNowToken.carid.brandname }} - {{ bookNowToken.carid.color }}</p>
            <div class="ticket-dates">
              <div class="date-item">Expires: <span>{{ formatDate(bookNowToken.expirydate) }}</span></div>
              <div class="date-item">Purchased: <span>{{ formatDate(bookNowToken.date) }}</span></div>
            </div>
            <div class="ticket-pricing">
              <div class="price-item">Amount Paid: <span>₹{{ formatPrice(bookNowToken.amountpaid) }}</span></div>
            </div>
            <div class="ticket-actions" *ngIf="bookNowToken.status === 'active'">
              <button (click)="cancelBookNowToken(bookNowToken)" class="cancel-btn">
                <i class="fas fa-times"></i>
                Cancel Token
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column - KYC and Calendar -->
    <div class="right-column">
      <!-- Desktop KYC Card -->
      <div class="kyc-card desktop-kyc">
        <div class="kyc-header">
          <h2 class="kyc-title">KYC Status</h2>
          <div class="kyc-status" [class]="getKycStatusClass()">
            <svg class="status-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
              <path d="M12 9v4"></path>
              <path d="M12 17h.01"></path>
            </svg>
            <span>{{ getKycStatusDisplay() }}</span>
          </div>
        </div>
        <p class="kyc-description">Please submit the required documents to get your account verified and access all features.</p>
        <button class="submit-docs-btn" (click)="openDocModal()" *ngIf="user().kycStatus === 'pending' || user().kycStatus === 'rejected'">
          <span *ngIf="user().kycStatus === 'pending'">Submit Documents</span>
          <span *ngIf="user().kycStatus === 'rejected'">Resubmit Documents</span>
        </button>
        
        <!-- Show rejection reason if KYC is rejected -->
        <div *ngIf="user().kycStatus === 'rejected'" class="kyc-rejection-info">
          <div class="rejection-notice">
            <svg class="warning-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
            <div class="rejection-content">
              <span class="rejection-title">Your KYC documents were rejected.</span>
              <!-- Show rejection comments if available -->
              <div *ngIf="getRejectionComments().length > 0" class="rejection-comments">
                <div *ngFor="let comment of getRejectionComments()" class="rejection-comment">
                  <p class="comment-text">{{ comment.comment }}</p>
                  <span class="comment-date">{{ formatDate(comment.date) }}</span>
                </div>
              </div>
              <p class="rejection-action">Please upload new documents to resubmit your KYC.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Calendar/Bookings Card -->
      <div class="calendar-card">
        <div class="calendar-header-section">
          <h2 class="section-title">My Bookings</h2>
          <button class="book-now-btn" (click)="navigateToBookings()">
            Book Now
          </button>
        </div>
        
        <!-- Loading state -->
        <div *ngIf="bookingsLoading()" class="loading-spinner" style="text-align: center; padding: 1rem;">
          <div style="display: inline-block; width: 1.5rem; height: 1.5rem; border: 2px solid #4a5568; border-radius: 50%; border-top-color: #3b82f6; animation: spin 1s ease-in-out infinite;"></div>
          <p style="margin-top: 0.5rem; color: #9ca3af; font-size: 0.875rem;">Loading bookings...</p>
        </div>

        <!-- Error state -->
        <div *ngIf="bookingsError() && !bookingsLoading()" class="error-message" style="color: #ef4444; text-align: center; margin: 1rem 0; padding: 1rem; background-color: rgba(239, 68, 68, 0.1); border-radius: 0.5rem;">
          {{ bookingsError() }}
        </div>

        <!-- Calendar -->
        <div class="calendar-container" *ngIf="!bookingsLoading() && !bookingsError()">
          <div class="calendar-header">
            <button class="calendar-nav-btn" (click)="goToPreviousMonth()">
              <svg fill="currentColor" viewBox="0 0 256 256">
                <path d="M165.66,202.34a8,8,0,0,1-11.32,11.32l-80-80a8,8,0,0,1,0-11.32l80-80a8,8,0,0,1,11.32,11.32L91.31,128Z"></path>
              </svg>
            </button>
            <p class="calendar-month">{{ getCurrentMonthDisplay() }}</p>
            <button class="calendar-nav-btn" (click)="goToNextMonth()">
              <svg fill="currentColor" viewBox="0 0 256 256">
                <path d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z"></path>
              </svg>
            </button>
          </div>
          <div class="calendar-weekdays">
            <span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span>
          </div>
          <div class="calendar-days">
            <div *ngFor="let day of calendarDays()" 
                 [class]="getCalendarDayClass(day)"
                 [title]="getBookingTooltip(day)">
              {{ day.day }}
            </div>
          </div>
        </div>

        <!-- No bookings state -->
        <div *ngIf="!bookingsLoading() && !bookingsError() && bookings().length === 0" class="no-bookings" style="text-align: center; padding: 2rem; color: #9ca3af;">
          <p>No bookings found. You haven't made any bookings yet.</p>
        </div>
      </div>

      <!-- AMC Section -->
      <div class="amc-card">
        <h2 class="section-title">AMC Records</h2>
        
        <!-- Loading state -->
        <div *ngIf="amcsLoading()" class="loading-spinner" style="text-align: center; padding: 1rem;">
          <div style="display: inline-block; width: 1.5rem; height: 1.5rem; border: 2px solid #4a5568; border-radius: 50%; border-top-color: #3b82f6; animation: spin 1s ease-in-out infinite;"></div>
          <p style="margin-top: 0.5rem; color: #9ca3af; font-size: 0.875rem;">Loading AMC records...</p>
        </div>

        <!-- Error state -->
        <div *ngIf="amcsError() && !amcsLoading()" class="error-message" style="color: #ef4444; text-align: center; margin: 1rem 0; padding: 1rem; background-color: rgba(239, 68, 68, 0.1); border-radius: 0.5rem;">
          {{ amcsError() }}
        </div>

        <!-- No AMC state -->
        <div *ngIf="!amcsLoading() && !amcsError() && amcs().length === 0" class="no-amcs" style="text-align: center; padding: 2rem; color: #9ca3af;">
          <p>No AMC records found. You don't have any AMC contracts yet.</p>
        </div>

        <!-- AMC cards -->
        <div class="amc-cards" *ngIf="!amcsLoading() && !amcsError() && amcs().length > 0">
          <div *ngFor="let amc of amcs()" class="amc-card-item" [class.expanded]="isAMCExpanded(amc._id!)">
            <!-- AMC Card Header -->
            <div class="amc-card-header" (click)="toggleAMCExpansion(amc._id!)">
              <div class="amc-car-info">
                <div class="amc-car-image">
                  <img [src]="amc.carid.images && amc.carid.images[0] || 'public/car.png'" [alt]="amc.carid.carname" />
                </div>
                <div class="amc-car-details">
                  <h3 class="amc-car-name">{{ amc.carid.carname }}</h3>
                  <p class="amc-car-brand">{{ amc.carid.brandname }} - {{ amc.carid.color }}</p>
                  <p class="amc-ticket-info">Ticket: #{{ amc.ticketid.ticketcustomid }}</p>
                </div>
              </div>
              <div class="amc-amount-info">
                <div class="amc-total-amount">
                  <span class="amount-label">Total AMC:</span>
                  <span class="amount-value">₹{{ getTotalAMCAmount(amc) }}</span>
                </div>
                <div class="amc-paid-amount">
                  <span class="amount-label">Paid:</span>
                  <span class="amount-value paid">₹{{ getPaidAMCAmount(amc) }}</span>
                </div>
                <div class="amc-pending-amount">
                  <span class="amount-label">Pending:</span>
                  <span class="amount-value pending">₹{{ getPendingAMCAmount(amc) }}</span>
                </div>
                <div class="amc-expand-icon">
                  <svg [class.rotated]="isAMCExpanded(amc._id!)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                </div>
              </div>
            </div>

            <!-- AMC Details (Expandable) -->
            <div class="amc-details" *ngIf="isAMCExpanded(amc._id!)">
              <div class="amc-details-header">
                <h4>AMC Payment History</h4>
                <div class="amc-next-due" *ngIf="getNextDueAMC(amc)">
                  <span class="next-due-label">Next Due:</span>
                  <span class="next-due-amount">₹{{ getNextDueAMC(amc).amount }}</span>
                  <span class="next-due-date" *ngIf="getNextDueAMC(amc).duedate">by {{ formatDate(getNextDueAMC(amc).duedate) }}</span>
                </div>
              </div>
              
              <div class="amc-records">
                <div *ngFor="let amount of amc.amcamount; let i = index" class="amc-record" [class.paid]="amount.paid" [class.overdue]="isAMCAmountOverdue(amount)">
                  <div class="amc-record-header">
                    <div class="amc-year">
                      <span class="year-label">Year {{ amount.year }}</span>
                      <span class="amount">₹{{ amount.amount }}</span>
                    </div>
                    <div class="amc-status">
                      <span class="status-badge" [class.paid]="amount.paid" [class.pending]="!amount.paid">
                        {{ amount.paid ? 'Paid' : 'Pending' }}
                      </span>
                    </div>
                  </div>
                  
                  <div class="amc-record-details">
                    <div class="amc-due-date" *ngIf="amount.duedate">
                      <span class="detail-label">Due Date:</span>
                      <span class="detail-value">{{ formatDate(amount.duedate) }}</span>
                    </div>
                    <div class="amc-paid-date" *ngIf="amount.paiddate">
                      <span class="detail-label">Paid Date:</span>
                      <span class="detail-value">{{ formatDate(amount.paiddate) }}</span>
                    </div>
                    <div class="amc-penalty" *ngIf="amount.penality > 0">
                      <span class="detail-label">Penalty:</span>
                      <span class="detail-value penalty">₹{{ amount.penality }}</span>
                    </div>
                    
                    <!-- Payment Button -->
                    <div class="amc-payment-section" *ngIf="!amount.paid">
                      <div class="test-mode-notice">
                        <small class="text-yellow-400">💳 Test Mode - Pay ₹1 (Actual: ₹{{ amount.amount }})</small>
                      </div>
                      <button 
                        class="amc-pay-btn"
                        (click)="initiateAMCPayment(amc, i)"
                        [disabled]="isAMCPaymentLoading() || !razorpayKey()"
                        [class.loading]="isAMCPaymentLoading()">
                        <span *ngIf="isAMCPaymentLoading()">Processing...</span>
                        <span *ngIf="!isAMCPaymentLoading()">Pay ₹1 (Test Mode)</span>
                      </button>
                      <div class="test-amount-notice">
                        <small class="text-blue-400">ℹ️ Test payment of ₹1 will mark this AMC as paid</small>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- KYC Document Modal -->
  <div *ngIf="showDocModal()" class="modal-overlay" (click)="closeDocModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">
          <span *ngIf="user().kycStatus === 'pending'">Submit Documents</span>
          <span *ngIf="user().kycStatus === 'rejected'">Resubmit Documents</span>
        </h3>
        <button class="modal-close-btn" (click)="closeDocModal()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <form class="kyc-form" (ngSubmit)="onSubmitKyc()">
        <!-- Show rejection reason if KYC is rejected -->
        <div *ngIf="user().kycStatus === 'rejected'" class="rejection-help-text">
          <div class="rejection-help-notice">
            <svg class="info-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
            </svg>
            <div>
              <p><strong>Your previous KYC submission was rejected.</strong></p>
              <!-- Show rejection comments in modal -->
              <div *ngIf="getRejectionComments().length > 0" class="modal-rejection-comments">
                <p class="rejection-reason-label">Rejection reasons:</p>
                <div *ngFor="let comment of getRejectionComments()" class="modal-rejection-comment">
                  <p class="modal-comment-text">• {{ comment.comment }}</p>
                  <span class="modal-comment-date">{{ formatDate(comment.date) }}</span>
                </div>
              </div>
              <p>Please upload new, clear documents and ensure all information is accurate.</p>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Aadhar ID</label>
          <input type="text" class="form-input" [ngModel]="kycForm().aadharId" (ngModelChange)="updateKycAadharId($event)" name="aadharId" placeholder="Enter your 12-digit Aadhar number" maxlength="12" required>
        </div>
        <div class="form-group">
          <label class="form-label">PAN ID</label>
          <input type="text" class="form-input" [ngModel]="kycForm().panId" (ngModelChange)="updateKycPanId($event)" name="panId" placeholder="Enter your PAN number (e.g., ABCDE1234F)" maxlength="10" required>
        </div>
        <div class="form-group">
          <label class="form-label">Upload Documents (PDF)</label>
          <input type="file" class="form-file" (change)="onFileSelect($event)" accept=".pdf" required>
          <div class="file-help-text">Upload a single PDF containing both Aadhar and PAN card images</div>
        </div>
        <button type="submit" class="submit-btn">
          Submit Documents
        </button>
      </form>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div *ngIf="showEditModal()" class="modal-overlay" (click)="closeEditModal()">
    <div class="edit-modal-content" (click)="$event.stopPropagation()">
      <div class="edit-modal-header">
        <h3 class="edit-modal-title">Edit Profile</h3>
        <button class="edit-modal-close-btn" (click)="closeEditModal()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div class="edit-modal-body">
        <form class="edit-form" (ngSubmit)="saveProfile()">
          <!-- Alert Messages -->
          <div *ngIf="editErrorMessage()" class="alert-error">{{ editErrorMessage() }}</div>
          <div *ngIf="editSuccessMessage()" class="alert-success">{{ editSuccessMessage() }}</div>

          <!-- Personal Information Section -->
          <div class="form-row">
            <div class="form-group-enhanced">
              <label class="form-label-enhanced">
                <span>👤</span> Full Name
              </label>
              <input type="text" class="form-input-enhanced" [ngModel]="editForm().name" (ngModelChange)="updateEditFormName($event)" name="name" placeholder="Enter your full name" required>
            </div>
            <div class="form-group-enhanced">
              <label class="form-label-enhanced">
                <span>📧</span> Email Address
              </label>
              <input type="email" class="form-input-enhanced" [ngModel]="editForm().email" (ngModelChange)="updateEditFormEmail($event)" name="email" placeholder="Enter your email" required>
              <div class="form-help-text">Changing email requires verification</div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group-enhanced">
              <label class="form-label-enhanced">
                <span>📱</span> Mobile Number
              </label>
              <input type="tel" class="form-input-enhanced" [ngModel]="editForm().phone" (ngModelChange)="updateEditFormPhone($event)" name="phone" placeholder="Enter mobile number">
            </div>
            <div class="form-group-enhanced">
              <label class="form-label-enhanced">
                <span>🎂</span> Date of Birth
              </label>
              <input type="date" class="form-input-enhanced" [ngModel]="editForm().dateofbirth" (ngModelChange)="updateEditFormDateOfBirth($event)" name="dateofbirth">
            </div>
          </div>

          <!-- Location Information Section -->
          <div class="form-row">
            <div class="form-group-enhanced">
              <label class="form-label-enhanced">
                <span>📍</span> Location
              </label>
              <input type="text" class="form-input-enhanced" [ngModel]="editForm().location" (ngModelChange)="updateEditFormLocation($event)" name="location" placeholder="City, State">
            </div>
            <div class="form-group-enhanced">
              <label class="form-label-enhanced">
                <span>📮</span> Pincode
              </label>
              <input type="text" class="form-input-enhanced" [ngModel]="editForm().pincode" (ngModelChange)="updateEditFormPincode($event)" name="pincode" placeholder="Enter pincode" maxlength="6">
            </div>
          </div>

          <div class="form-group-enhanced">
            <label class="form-label-enhanced">
              <span>🏠</span> Address
            </label>
            <textarea class="form-input-enhanced" [ngModel]="editForm().address" (ngModelChange)="updateEditFormAddress($event)" name="address" placeholder="Enter your full address" rows="2" style="resize: vertical; min-height: 3rem;"></textarea>
          </div>

          <!-- Add some bottom spacing -->
          <div style="height: 1rem;"></div>
        </form>
      </div>

      <div class="edit-modal-actions">
        <button type="button" class="btn-secondary-enhanced" (click)="openChangePasswordModal()">
          <span>🔐</span> Change Password
        </button>
        <button type="submit" class="btn-primary-enhanced" (click)="saveProfile()" [disabled]="editSubmitting()">
          <span *ngIf="editSubmitting()">💾 Saving...</span>
          <span *ngIf="!editSubmitting()">💾 Save Changes</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Verify Email Modal -->
  <div *ngIf="showVerifyEmailModal()" class="modal-overlay" (click)="closeVerifyEmailModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Verify New Email</h3>
        <button class="modal-close-btn" (click)="closeVerifyEmailModal()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <form class="kyc-form" (ngSubmit)="verifyNewEmail()">
        <div *ngIf="verifyErrorMessage()" class="field-error">{{ verifyErrorMessage() }}</div>
        <div *ngIf="verifySuccessMessage()" class="file-info" style="color:#10b981">{{ verifySuccessMessage() }}</div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" [ngModel]="verifyForm().email" (ngModelChange)="updateVerifyFormEmail($event)" name="verifyEmail" required>
        </div>
        <div class="form-group">
          <label class="form-label">Verification Code</label>
          <input type="text" class="form-input" [ngModel]="verifyForm().code" (ngModelChange)="updateVerifyFormCode($event)" name="verifyCode" maxlength="6" required>
        </div>
        <div style="display:flex; gap:0.5rem">
          <button type="submit" class="submit-btn" [disabled]="verifySubmitting()">
            <span *ngIf="verifySubmitting()">Verifying...</span>
            <span *ngIf="!verifySubmitting()">Verify</span>
          </button>
          <button type="button" class="submit-btn" style="background:#374151" (click)="resendVerifyCode()" [disabled]="verifySubmitting()">Resend Code</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div *ngIf="showChangePasswordModal()" class="modal-overlay" (click)="closeChangePasswordModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Change Password</h3>
        <button class="modal-close-btn" (click)="closeChangePasswordModal()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <form class="kyc-form" (ngSubmit)="submitNewPassword()">
        <div *ngIf="passwordErrorMessage()" class="field-error">{{ passwordErrorMessage() }}</div>
        <div *ngIf="passwordSuccessMessage()" class="file-info" style="color:#10b981">{{ passwordSuccessMessage() }}</div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" [ngModel]="user().email" name="resetEmail" disabled>
        </div>
        <div class="form-group" style="display:flex; gap:0.5rem; align-items:center">
          <div style="flex:1">
            <label class="form-label">Reset Code</label>
            <input type="text" class="form-input" [ngModel]="resetForm().code" (ngModelChange)="updateResetFormCode($event)" name="resetCode" maxlength="6" required>
          </div>
          <button type="button" class="submit-btn" style="margin-top:1.6rem" (click)="requestPasswordCode()" [disabled]="passwordRequesting()">{{ passwordRequesting() ? 'Sending...' : 'Send Code' }}</button>
        </div>
        <div class="form-group">
          <label class="form-label">New Password</label>
          <input type="password" class="form-input" [ngModel]="resetForm().newPassword" (ngModelChange)="updateResetFormPassword($event)" name="newPassword" minlength="6" required>
        </div>
        <button type="submit" class="submit-btn" [disabled]="passwordSubmitting">
          <span *ngIf="passwordSubmitting">Changing...</span>
          <span *ngIf="!passwordSubmitting">Change Password</span>
        </button>
      </form>
    </div>
  </div>

  <!-- AMC Payment Success Modal -->
  <div *ngIf="showAMCPaymentModal()" class="modal-overlay" (click)="closeAMCPaymentModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Payment Successful!</h3>
        <button class="modal-close-btn" (click)="closeAMCPaymentModal()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="success-icon">
          <svg class="w-16 h-16 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <div class="success-message">
          <h4 class="text-lg font-semibold text-white mb-2">AMC Payment Completed!</h4>
          <p class="text-gray-300 mb-4">
            Your AMC payment for <strong>{{ selectedAMC()?.carid?.carname }}</strong> 
            (Year {{ selectedAMC()?.amcamount?.[selectedAMCYear()]?.year }}) has been processed successfully.
          </p>
          <div class="payment-details">
            <div class="detail-row">
              <span class="detail-label">Test Payment:</span>
              <span class="detail-value">₹1 (Test Mode)</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Actual Amount:</span>
              <span class="detail-value">₹{{ getAMCPaymentAmount(selectedAMC()!, selectedAMCYear()) }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Payment Date:</span>
              <span class="detail-value">{{ getCurrentDate() }}</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Status:</span>
              <span class="detail-value success">Paid</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn-primary" (click)="closeAMCPaymentModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- AMC Payment Error Display -->
  <div *ngIf="amcPaymentError()" class="error-message" style="position: fixed; top: 20px; right: 20px; z-index: 1000; max-width: 400px; background-color: #ef4444; color: white; padding: 1rem; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
    <div class="flex items-center justify-between">
      <div class="flex items-center">
        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
        </svg>
        <span>{{ amcPaymentError() }}</span>
      </div>
      <button (click)="amcPaymentError.set('')" class="ml-4 text-white hover:text-gray-200">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Shared Member Modal -->
  <div *ngIf="showSharedMemberModal()" class="shared-member-modal-overlay" (click)="closeSharedMemberModal()">
    <div class="shared-member-modal-content" (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="shared-member-modal-header">
        <div class="modal-title-section">
          <div class="modal-icon">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
            </svg>
          </div>
          <div class="modal-title-text">
            <h3 class="modal-title">Add Shared Member</h3>
            <p class="modal-subtitle">Add a family member or friend to share your vehicle access</p>
          </div>
        </div>
        <button class="modal-close-btn" (click)="closeSharedMemberModal()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <form class="shared-member-form" (ngSubmit)="onSubmitSharedMember()">
        <!-- Alert Messages -->
        <div *ngIf="sharedMemberSuccessMessage()" class="shared-member-alert shared-member-alert-success">
          <div class="alert-icon-wrapper">
            <svg class="alert-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="alert-content">
            <h4 class="alert-title">Success!</h4>
            <p class="alert-message">{{ sharedMemberSuccessMessage() }}</p>
          </div>
        </div>
        
        <div *ngIf="sharedMemberErrorMessage()" class="shared-member-alert shared-member-alert-error">
          <div class="alert-icon-wrapper">
            <svg class="alert-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
          </div>
          <div class="alert-content">
            <h4 class="alert-title">Error</h4>
            <p class="alert-message">{{ sharedMemberErrorMessage() }}</p>
          </div>
        </div>

        <!-- Personal Information Section -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-icon-wrapper">
              <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
            </div>
            <div class="section-content">
              <h4 class="section-title">Personal Information</h4>
              <p class="section-description">Enter the member's basic details for identification</p>
            </div>
          </div>
          
          <div class="form-grid">
            <div class="form-field">
              <label class="field-label">
                <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                <span class="label-text">Full Name</span>
                <span class="required-indicator">*</span>
              </label>
              <div class="input-wrapper">
                <input type="text" class="field-input" [ngModel]="sharedMemberForm().name" (ngModelChange)="updateSharedMemberName($event)" name="name" placeholder="Enter full name" required>
                <div class="input-focus-border"></div>
              </div>
            </div>
            
            <div class="form-field">
              <label class="field-label">
                <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
                <span class="label-text">Email Address</span>
                <span class="required-indicator">*</span>
              </label>
              <div class="input-wrapper">
                <input type="email" class="field-input" [ngModel]="sharedMemberForm().email" (ngModelChange)="updateSharedMemberEmail($event)" name="email" placeholder="Enter email address" required>
                <div class="input-focus-border"></div>
              </div>
            </div>
            
            <div class="form-field">
              <label class="field-label">
                <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                </svg>
                <span class="label-text">Mobile Number</span>
                <span class="required-indicator">*</span>
              </label>
              <div class="input-wrapper">
                <input type="tel" class="field-input" [ngModel]="sharedMemberForm().mobileNumber" (ngModelChange)="updateSharedMemberMobile($event)" name="mobileNumber" placeholder="Enter 10-digit mobile number" maxlength="10" required>
                <div class="input-focus-border"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Identity Documents Section -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-icon-wrapper">
              <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
            </div>
            <div class="section-content">
              <h4 class="section-title">Identity Documents</h4>
              <p class="section-description">Provide government-issued identification details</p>
            </div>
          </div>
          
          <div class="form-grid">
            <div class="form-field">
              <label class="field-label">
                <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span class="label-text">Aadhar Number</span>
                <span class="required-indicator">*</span>
              </label>
              <div class="input-wrapper">
                <input type="text" class="field-input" [ngModel]="sharedMemberForm().aadharNumber" (ngModelChange)="updateSharedMemberAadhar($event)" name="aadharNumber" placeholder="Enter 12-digit Aadhar number" maxlength="12" required>
                <div class="input-focus-border"></div>
              </div>
            </div>
            
            <div class="form-field">
              <label class="field-label">
                <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span class="label-text">PAN Number</span>
                <span class="required-indicator">*</span>
              </label>
              <div class="input-wrapper">
                <input type="text" class="field-input" [ngModel]="sharedMemberForm().panNumber" (ngModelChange)="updateSharedMemberPan($event)" name="panNumber" placeholder="Enter PAN number (e.g., ABCDE1234F)" maxlength="10" required>
                <div class="input-focus-border"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Document Upload Section -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-icon-wrapper">
              <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
              </svg>
            </div>
            <div class="section-content">
              <h4 class="section-title">KYC Documents</h4>
              <p class="section-description">Upload supporting documents in PDF format</p>
            </div>
          </div>
          
          <div class="upload-section">
            <div class="upload-area" (click)="triggerSharedMemberFileInput()" [class.has-files]="sharedMemberFiles().length > 0">
              <div class="upload-content">
                <div class="upload-icon-wrapper">
                  <svg class="upload-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                  </svg>
                </div>
                <div class="upload-text">
                  <span class="upload-title">Click to upload or drag and drop</span>
                  <span class="upload-subtitle">PDF files only (Max 10MB each)</span>
                </div>
                <div class="upload-hint">
                  <svg class="hint-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <span>Multiple files supported</span>
                </div>
              </div>
              <input type="file" class="hidden-file-input" (change)="onSharedMemberFileSelect($event)" accept=".pdf" multiple #fileInput>
            </div>
            
            <!-- File Preview -->
            <div *ngIf="sharedMemberFiles().length > 0" class="file-preview-section">
              <div class="file-preview-header">
                <div class="file-count-info">
                  <svg class="file-count-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <span class="file-count">{{ sharedMemberFiles().length }} file(s) selected</span>
                </div>
                <button type="button" class="clear-all-btn" (click)="clearAllSharedMemberFiles()">
                  <svg class="clear-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                  Clear All
                </button>
              </div>
              <div class="file-list">
                <div *ngFor="let file of sharedMemberFiles(); let i = index" class="file-item">
                  <div class="file-info">
                    <div class="file-icon-wrapper">
                      <svg class="file-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                      </svg>
                    </div>
                    <div class="file-details">
                      <span class="file-name">{{ file.name }}</span>
                      <span class="file-size">{{ (file.size / 1024 / 1024).toFixed(2) }} MB</span>
                    </div>
                  </div>
                  <button type="button" class="remove-file-btn" (click)="removeSharedMemberFile(i)">
                    <svg class="remove-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Information Cards -->
        <div class="info-cards-section">
          <div class="info-card">
            <div class="info-card-icon-wrapper">
              <svg class="info-card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
              </svg>
            </div>
            <div class="info-card-content">
              <h5 class="info-card-title">Up to 3 members</h5>
              <p class="info-card-description">You can add up to 3 shared members per vehicle</p>
            </div>
          </div>
          
          <div class="info-card">
            <div class="info-card-icon-wrapper">
              <svg class="info-card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <div class="info-card-content">
              <h5 class="info-card-title">Admin approval</h5>
              <p class="info-card-description">All shared members require admin approval</p>
            </div>
          </div>
          
          <div class="info-card">
            <div class="info-card-icon-wrapper">
              <svg class="info-card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <div class="info-card-content">
              <h5 class="info-card-title">Accurate information</h5>
              <p class="info-card-description">Ensure all details are correct and up-to-date</p>
            </div>
          </div>
          
          <div class="info-card">
            <div class="info-card-icon-wrapper">
              <svg class="info-card-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM4.5 19.5h15a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5h-15A1.5 1.5 0 003 6v12a1.5 1.5 0 001.5 1.5z"></path>
              </svg>
            </div>
            <div class="info-card-content">
              <h5 class="info-card-title">Notifications</h5>
              <p class="info-card-description">You'll receive updates on approval status</p>
            </div>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeSharedMemberModal()">
            <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
            <span>Cancel</span>
          </button>
          <button type="submit" class="btn-submit" [disabled]="sharedMemberSubmitting()">
            <svg *ngIf="!sharedMemberSubmitting()" class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
            <svg *ngIf="sharedMemberSubmitting()" class="btn-icon loading" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            <span *ngIf="sharedMemberSubmitting()">Adding Member...</span>
            <span *ngIf="!sharedMemberSubmitting()">Add Shared Member</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<style>
@keyframes spin {
  to { transform: rotate(360deg); }
}

/* AMC Payment Button Styles */
.amc-payment-section {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid #374151;
}

.test-mode-notice {
  margin-bottom: 0.5rem;
  text-align: center;
}

.amount-limit-notice {
  margin-top: 0.5rem;
  text-align: center;
}

.test-amount-notice {
  margin-top: 0.5rem;
  text-align: center;
}

.amc-pay-btn {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  color: white;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 0.5rem;
  font-weight: 600;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
}

.amc-pay-btn:hover:not(:disabled) {
  background: linear-gradient(135deg, #1d4ed8, #1e40af);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
}

.amc-pay-btn:disabled {
  background: #6b7280;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.amc-pay-btn.loading {
  background: #6b7280;
  cursor: not-allowed;
}

/* Payment Success Modal Styles */
.success-icon {
  text-align: center;
  margin-bottom: 1rem;
}

.success-message {
  text-align: center;
}

.payment-details {
  background-color: #1f2937;
  border-radius: 0.5rem;
  padding: 1rem;
  margin-top: 1rem;
}

.detail-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.detail-row:last-child {
  margin-bottom: 0;
}

.detail-label {
  color: #9ca3af;
  font-size: 0.875rem;
}

.detail-value {
  color: #ffffff;
  font-weight: 600;
}

.detail-value.success {
  color: #10b981;
}

.modal-actions {
  display: flex;
  justify-content: center;
  margin-top: 1.5rem;
}

.btn-primary {
  background: #3b82f6;
  color: white;
  border: none;
  padding: 0.75rem 2rem;
  border-radius: 0.5rem;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.btn-primary:hover {
  background: #2563eb;
}

/* Shared Members Styles */
.shared-members-section {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid #374151;
}

.shared-members-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.shared-members-title {
  font-size: 1rem;
  font-weight: 600;
  color: #ffffff;
  margin: 0;
}

.add-shared-member-btn {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 0.375rem;
  font-size: 0.75rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
}

.add-shared-member-btn:hover:not(:disabled) {
  background: linear-gradient(135deg, #059669, #047857);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(16, 185, 129, 0.4);
}

.add-shared-member-btn:disabled {
  background: #6b7280;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.add-icon {
  width: 1rem;
  height: 1rem;
}

.shared-members-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.shared-member-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem;
  background-color: #1f2937;
  border-radius: 0.5rem;
  border: 1px solid #374151;
  transition: all 0.3s ease;
}

.shared-member-item:hover {
  background-color: #374151;
  border-color: #4b5563;
}

.shared-member-info {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex: 1;
}

.member-avatar {
  width: 2.5rem;
  height: 2.5rem;
  background-color: #3b82f6;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.member-icon {
  width: 1.25rem;
  height: 1.25rem;
  color: white;
}

.member-details {
  flex: 1;
  min-width: 0;
}

.member-name {
  font-weight: 600;
  color: #ffffff;
  font-size: 0.875rem;
  margin-bottom: 0.25rem;
}

.member-email {
  color: #9ca3af;
  font-size: 0.75rem;
  margin-bottom: 0.125rem;
}

.member-mobile {
  color: #9ca3af;
  font-size: 0.75rem;
}

.member-status {
  margin-right: 0.75rem;
}

.status-badge {
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
}

.status-badge.accepted {
  background-color: rgba(16, 185, 129, 0.2);
  color: #10b981;
  border: 1px solid rgba(16, 185, 129, 0.3);
}

.status-badge.rejected {
  background-color: rgba(239, 68, 68, 0.2);
  color: #ef4444;
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.status-badge.pending {
  background-color: rgba(245, 158, 11, 0.2);
  color: #f59e0b;
  border: 1px solid rgba(245, 158, 11, 0.3);
}

.member-actions {
  display: flex;
  gap: 0.5rem;
}

.delete-member-btn {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
  border: 1px solid rgba(239, 68, 68, 0.3);
  padding: 0.5rem;
  border-radius: 0.375rem;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.delete-member-btn:hover {
  background: rgba(239, 68, 68, 0.2);
  border-color: rgba(239, 68, 68, 0.5);
  transform: translateY(-1px);
}

.delete-icon {
  width: 1rem;
  height: 1rem;
}

.member-limit-notice {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.25rem;
}

.warning-icon {
  flex-shrink: 0;
}

.no-shared-members {
  text-align: center;
  padding: 1rem;
  color: #9ca3af;
  font-size: 0.75rem;
  background-color: rgba(107, 114, 128, 0.1);
  border-radius: 0.5rem;
  border: 1px dashed #6b7280;
}

/* Responsive adjustments for shared members */
@media (max-width: 768px) {
  .shared-member-item {
    flex-direction: column;
    align-items: stretch;
    gap: 0.75rem;
  }
  
  .shared-member-info {
    justify-content: space-between;
  }
  
  .member-actions {
    justify-content: flex-end;
  }
  
  .member-status {
    margin-right: 0;
  }
}

/* Modern Shared Member Form Styles */
.shared-member-form {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  padding: 0;
}

/* Alert Messages */
.alert-success, .alert-error {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem;
  border-radius: 0.75rem;
  font-weight: 500;
  margin-bottom: 1rem;
}

.alert-success {
  background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
  border: 1px solid rgba(16, 185, 129, 0.3);
  color: #10b981;
}

.alert-error {
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
  border: 1px solid rgba(239, 68, 68, 0.3);
  color: #ef4444;
}

.alert-icon {
  width: 1.25rem;
  height: 1.25rem;
  flex-shrink: 0;
}

/* Form Sections */
.form-section {
  background: linear-gradient(135deg, #1f2937, #374151);
  border-radius: 1rem;
  padding: 1.5rem;
  border: 1px solid #4b5563;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.section-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid #4b5563;
}

.section-icon {
  width: 2rem;
  height: 2rem;
  color: #3b82f6;
  background: rgba(59, 130, 246, 0.1);
  border-radius: 0.5rem;
  padding: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.section-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: #ffffff;
  margin: 0;
}

/* Form Layout */
.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-bottom: 1rem;
}

.form-row:last-child {
  margin-bottom: 0;
}

/* Compact Form Styles */
.form-section.compact-form {
  padding: 0.75rem;
}

.form-grid-wide {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 0.75rem;
}

.form-field {
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
}

.field-label {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: #d1d5db;
}

.label-icon {
  width: 0.875rem;
  height: 0.875rem;
  color: #9ca3af;
}

.field-input {
  padding: 0.625rem 0.75rem;
  border: 2px solid #4b5563;
  border-radius: 0.5rem;
  background: #111827;
  color: #ffffff;
  font-size: 0.75rem;
  transition: all 0.3s ease;
}

.field-input:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  background: #1f2937;
}

.field-input::placeholder {
  color: #6b7280;
  font-size: 0.75rem;
}

/* Compact Upload Styles */
.form-section.compact-upload {
  padding: 0.75rem;
}

.upload-row {
  display: flex;
  gap: 1rem;
  align-items: flex-start;
}

.upload-section {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.upload-label {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  font-size: 0.75rem;
  font-weight: 600;
  color: #d1d5db;
}

.upload-icon-small {
  width: 0.875rem;
  height: 0.875rem;
  color: #9ca3af;
}

.upload-area-small {
  border: 2px dashed #4b5563;
  border-radius: 0.5rem;
  padding: 0.75rem;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  background: linear-gradient(135deg, #111827, #1f2937);
}

.upload-area-small:hover {
  border-color: #3b82f6;
  background: linear-gradient(135deg, #1f2937, #374151);
}

.upload-area-small.has-files {
  border-color: #10b981;
  background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(5, 150, 105, 0.05));
}

.upload-text-small {
  font-size: 0.75rem;
  color: #9ca3af;
}

.file-preview-compact {
  flex: 1;
  min-width: 200px;
}

.file-count-small {
  font-size: 0.75rem;
  color: #9ca3af;
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.file-list-compact {
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
}

.file-item-compact {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem;
  background: #1f2937;
  border-radius: 0.375rem;
  border: 1px solid #374151;
}

.file-name-small {
  color: #ffffff;
  font-size: 0.75rem;
  font-weight: 500;
  flex: 1;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-right: 0.5rem;
}

.remove-file-btn-small {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
  border: 1px solid rgba(239, 68, 68, 0.3);
  padding: 0.25rem;
  border-radius: 0.25rem;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.remove-file-btn-small:hover {
  background: rgba(239, 68, 68, 0.2);
  border-color: rgba(239, 68, 68, 0.5);
}

.remove-icon-small {
  width: 0.75rem;
  height: 0.75rem;
}

/* Upload Area */
.upload-area {
  border: 2px dashed #4b5563;
  border-radius: 1rem;
  padding: 2rem;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  background: linear-gradient(135deg, #111827, #1f2937);
}

.upload-area:hover {
  border-color: #3b82f6;
  background: linear-gradient(135deg, #1f2937, #374151);
  transform: translateY(-2px);
}

.upload-area.has-files {
  border-color: #10b981;
  background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(5, 150, 105, 0.05));
}


.upload-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
}


.upload-icon {
  width: 3rem;
  height: 3rem;
  color: #6b7280;
  transition: color 0.3s ease;
}


.upload-area:hover .upload-icon {
  color: #3b82f6;
}

.upload-text {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.upload-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: #ffffff;
  margin: 0;
}

.upload-subtitle {
  font-size: 0.875rem;
  color: #9ca3af;
  margin: 0;
}

.upload-requirements {
  font-size: 0.75rem;
  color: #6b7280;
  margin: 0;
}

.hidden-file-input {
  display: none;
}

/* File Preview */
.file-preview-section {
  margin-top: 1rem;
  background: #111827;
  border-radius: 0.75rem;
  border: 1px solid #374151;
  overflow: hidden;
}

.preview-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  background: #1f2937;
  border-bottom: 1px solid #374151;
}

.preview-title {
  font-size: 0.875rem;
  font-weight: 600;
  color: #ffffff;
  margin: 0;
}

.file-count {
  font-size: 0.75rem;
  color: #9ca3af;
  background: #374151;
  padding: 0.25rem 0.75rem;
  border-radius: 1rem;
}

.file-list {
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.file-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  background: #1f2937;
  border-radius: 0.5rem;
  border: 1px solid #374151;
  transition: all 0.3s ease;
}

.file-item:hover {
  background: #374151;
  border-color: #4b5563;
}

.file-info {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex: 1;
  min-width: 0;
}

.file-icon-wrapper {
  width: 2.5rem;
  height: 2.5rem;
  background: rgba(239, 68, 68, 0.1);
  border-radius: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.file-icon {
  width: 1.25rem;
  height: 1.25rem;
  color: #ef4444;
}

.file-details {
  display: flex;
  flex-direction: column;
  gap: 0.125rem;
  min-width: 0;
}

.file-name {
  color: #ffffff;
  font-size: 0.875rem;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.file-size {
  color: #9ca3af;
  font-size: 0.75rem;
}

.remove-file-btn {
  background: rgba(239, 68, 68, 0.1);
  color: #ef4444;
  border: 1px solid rgba(239, 68, 68, 0.3);
  padding: 0.5rem;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}


.remove-file-btn:hover {
  background: rgba(239, 68, 68, 0.2);
  border-color: rgba(239, 68, 68, 0.5);
  transform: scale(1.05);
}

.remove-icon {
  width: 1rem;
  height: 1rem;
}

/* Information Section */
.info-section {
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(37, 99, 235, 0.05));
  border: 1px solid rgba(59, 130, 246, 0.2);
  border-radius: 1rem;
  padding: 1.5rem;
}

/* Compact Information Section */
.info-section-compact {
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(37, 99, 235, 0.05));
  border: 1px solid rgba(59, 130, 246, 0.2);
  border-radius: 0.5rem;
  padding: 0.75rem;
}

.info-items-row {
  display: flex;
  gap: 1rem;
  justify-content: space-between;
}

.info-item-compact {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  padding: 0.5rem;
  background: rgba(55, 65, 81, 0.5);
  border-radius: 0.375rem;
  font-size: 0.75rem;
  color: #d1d5db;
  flex: 1;
  justify-content: center;
}

.info-icon-small {
  width: 0.875rem;
  height: 0.875rem;
  color: #3b82f6;
  flex-shrink: 0;
}

.info-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.info-icon {
  width: 1.25rem;
  height: 1.25rem;
  color: #3b82f6;
}

.info-title {
  font-size: 1rem;
  font-weight: 600;
  color: #ffffff;
  margin: 0;
}

.info-content {
  background: rgba(31, 41, 55, 0.5);
  border-radius: 0.75rem;
  padding: 1rem;
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 0.75rem;
}

.info-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem;
  background: rgba(55, 65, 81, 0.5);
  border-radius: 0.5rem;
  font-size: 0.875rem;
  color: #d1d5db;
}

.info-item-icon {
  width: 1rem;
  height: 1rem;
  color: #3b82f6;
  flex-shrink: 0;
}

/* Form Actions */
.form-actions {
  display: flex;
  gap: 1rem;
  justify-content: flex-end;
  padding-top: 1rem;
  border-top: 1px solid #374151;
}

.btn-cancel, .btn-submit {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.875rem 1.5rem;
  border-radius: 0.75rem;
  font-weight: 600;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
}

.btn-cancel {
  background: rgba(107, 114, 128, 0.1);
  color: #9ca3af;
  border: 1px solid rgba(107, 114, 128, 0.3);
}

.btn-cancel:hover {
  background: rgba(107, 114, 128, 0.2);
  border-color: rgba(107, 114, 128, 0.5);
  transform: translateY(-1px);
}

.btn-submit {
  background: linear-gradient(135deg, #10b981, #059669);
  color: white;
  box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
}

.btn-submit:hover:not(:disabled) {
  background: linear-gradient(135deg, #059669, #047857);
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(16, 185, 129, 0.4);
}

.btn-submit:disabled {
  background: #6b7280;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.btn-icon {
  width: 1rem;
  height: 1rem;
}

.btn-icon.loading {
  animation: spin 1s linear infinite;
}

@keyframes spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

/* Responsive Design */
@media (max-width: 1200px) {
  .form-grid-wide {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (max-width: 900px) {
  .form-grid-wide {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .upload-row {
    flex-direction: column;
  }
  
  .info-items-row {
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  
  .info-item-compact {
    flex: 1;
    min-width: calc(50% - 0.25rem);
  }
}

@media (max-width: 768px) {
  .form-row {
    grid-template-columns: 1fr;
  }
  
  .form-grid-wide {
    grid-template-columns: 1fr;
  }
  
  .info-grid {
    grid-template-columns: 1fr;
  }
  
  .info-items-row {
    flex-direction: column;
  }
  
  .info-item-compact {
    min-width: 100%;
  }
  
  .form-actions {
    flex-direction: column;
  }
  
  .btn-cancel, .btn-submit {
    width: 100%;
    justify-content: center;
  }
}
</style>
